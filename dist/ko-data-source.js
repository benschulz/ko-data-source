/*
 Copyright (c) 2015, Ben Schulz
 License: BSD 3-clause (http://opensource.org/licenses/BSD-3-Clause)
*/
var n;
function G(r){var p,v,D,w,t,q,x,H,E,F,z,y;p=function(){var g;g=function(){function e(a,k){return Object.prototype.hasOwnProperty.call(a,k)}return{Lb:function(a,k){if(a===k)return!0;var h=!!k&&"function"===typeof k.valueOf;return!!a&&"function"===typeof a.valueOf&&h&&a.valueOf()===k.valueOf()},extend:function(a,k){Array.prototype.slice.call(arguments,1).forEach(function(h){for(var c=Object.keys(h),d=0,f=c.length;d<f;d++){var l=c[d],A=Object.getOwnPropertyDescriptor(h,l);void 0!==A&&A.enumerable&&Object.defineProperty(a,
l,A)}});return a},Da:function(a,k){for(var h in a)e(a,h)&&k(h,a[h])},v:e,Vb:function(a,k){var h={},c;for(c in a)e(a,c)&&(h[c]=k(a[c],c,a));return h}}}();return function(e){return e}(function(e,a,k){return{o:e,a:a,qa:k}}(function(e){function a(d){return d.filter(function(f,l,d){return d.lastIndexOf(f)===l})}function k(d,f){for(var l=d.length,a=-1,b=0;b<l;++b)if(f(d[b])){if(0<=a)throw Error("Multiple elements match the predicate.");a=b}return a}function h(d,f){return d&&"function"===typeof d.valueOf&&
f&&"function"===typeof f.valueOf?d.valueOf()<=f.valueOf()?d.valueOf()<f.valueOf()?-1:0:1:d<=f?d<f?-1:0:1}function c(d,f){var l=d.length,a=Array(l),b=Array(l),m;for(m=0;m<l;++m)a[m]=m,b[m]=d[m];m=d;d=b;b=m;a.sort(function(b,m){return f(d[b],d[m])||b-m});for(m=0;m<l;++m)b[m]=d[a[m]];return b}return{contains:function(a,f){return 0<=a.indexOf(f)},Ob:function(d){if(50<d.length){for(var f=d.length,l={},c,b=0;b<f;++b)if(c=d[b],"string"===typeof c)if(e.v(l,c))break;else l[c]=!0;else if(d.lastIndexOf(c)!==
b)break;if(!(b>=f)){for(var m=d.slice(0,b);b<f;++b)c=d[b],"string"===typeof c?e.v(l,c)||(l[c]=!0,m.push(c)):d.lastIndexOf(c)===b&&m.push(c);d=m}}else d=a(d);return d},Pb:function(a,f){return Array.prototype.concat.apply([],a.map(f))},gb:function(a,f){var c=k(a,f);if(0>c)throw Error("None of the elements matches the predicate.");return a[c]},oa:function(a,f){var c=k(a,f);return 0<=c?a[c]:null},Ga:function(a,f){var l=f||h;window.chrome?l=c(a,l):(a.sort(l),l=a);return l}}}(g),g,{Mb:function(e){return e.replace(/([A-Z])/g,
function(a){return"-"+a.toLowerCase()})},Nb:function(e){return e.replace(/-([a-z])/g,function(a){return a[1].toUpperCase()})},format:function(e){var a=arguments;return e.replace(/{(\d+)}/g,function(k,h){var c=parseInt(h,10)+1;return typeof a.length<=c?k:a[c]})}}))}();v=function(g){return function(e){return e}(function(e){function a(a){var d={get length(){return this.length},contains:function(f){return 0<=this.Ha(f)},filter:function(f){for(var a=this.length,c=[],b=0;b<a;++b){var m=this.get(b);f(m,
b,this)&&c.push(m)}return new k(c)},forEach:function(a){for(var c=this.length,d=0;d<c;++d)a(this.get(d),d,this)},get:function(a){return this.get(a)},map:function(a){for(var c=this.length,d=Array(c),b=0;b<c;++b)d[b]=a(this.get(b),b,this);return new k(d)},readOnly:function(){return new h(this)},reduce:function(a,c){var d=1<arguments.length,b=this.length;if(!d&&0===b)throw new TypeError("An empty list can not be reduced, specify an initial value.");for(var m=d?c:this.get(0),d=d?0:1;d<b;++d)m=a(m,this.get(d));
return m},slice:function(a,c){var d=this.length;a=0>=arguments.length?0:0<=a?a:d+a;c=1>=arguments.length?d:0<=c?c:d+c;for(var d=c-a,b=Array(d),m=0;m<d;++m)b[m]=this.get(a+m);return new k(b)},J:function(){for(var a=this.length,c=Array(a),d=0;d<a;++d)c[d]=this.get(d);return c},Ha:function(a){for(var c=this.length,d=0;d<c;++d)if(this.get(d)===a)return d;return-1}};return e.a.extend(d,{get length(){return this.length},contains:d.contains,filter:d.filter,forEach:d.forEach,get:function(a){return this.get(a)},
map:d.map,readOnly:d.readOnly,reduce:d.reduce,slice:d.slice,toArray:d.J,tryFirstIndexOf:d.Ha},a)}function k(a){this.va=a}function h(a){this.V=a}k.prototype=a({get length(){return this.va.length},get:function(a){return this.va[a]},J:function(){return this.va.slice()}});h.prototype=a({get length(){return this.V.length},get:function(a){return this.V.get(a)}});return{ba:function(a){return new k(a||[])},Ya:a}}(g))}(p);D=function(g,e){return function(a){return a}(function(a,k){function h(b){if("string"!==
typeof b)throw Error("Ids must be strings. (given: `"+b+"`, type: `"+typeof b+"`)");return b}function c(b,m){return a.a.v(b,h(m))?b[m]:-1}function d(b,a){var d=c(b,a);if(0>d)throw Error("No element with id `"+a+"`.");return d}function f(b,a,d,c,l){if(c>=l)return c;var h=Math.floor((c+l)/2);return 0>a(d,b[h])?f(b,a,d,c,h):f(b,a,d,h+1,l)}function l(b,a,d,c,f){function l(c,f){var J=h.length,e=a.slice(c,f);h=h.concat(e);e.forEach(function(a){d[b(a)]=J;++J})}var h=[],e=0;c.forEach(function(b){l(e,b);e=
b;f(h)});l(e,a.length);return h}function e(b){this.B=function(a){return h(b(a))};this.m=[];this.p={};this.t=null}e.prototype=k.Ya({get length(){return this.m.length},get:function(b){return this.m[b]},Ua:function(b){return this.m[d(this.p,b)]},bc:function(b){b=c(this.p,b);return 0<=b?this.m[b]:null},clear:function(){this.m=[];this.p={}},contains:function(b){b=(0,this.B)(b);return 0<=c(this.p,b)},za:function(b){return 0<=c(this.p,b)},removeAll:function(b){this.fb(b.map(this.B))},fb:function(b){if(b.length){var a=
this.B,c=this.m,f=this.p;b=b.map(function(b){return d(f,b)+1});b.sort(function(b,a){return b-a});this.m=l(a,c,f,b,function(b){b=b.pop();b=a(b);delete f[b]})}},hb:function(b){var m=this.B,c=this.m,d=this.p;this.t=b;a.o.Ga(c,b);b=!1;for(var f=0;f<c.length;++f){var h=m(c[f]);b=b||d[h]!==f;d[h]=f}return b},ra:function(b){if(this.t)throw Error("`updateAll` must not be called on a sorted `IndexedTable`. Use a combination of order-preserving `tryUpdateAll`, `removeAll` and `insertAll` instead.");if(b.length){var a=
this.B,c=this.m,f=this.p;b.forEach(function(b){var h=d(f,a(b));c[h]=b})}},jb:function(b){if(!this.t)throw Error("`tryUpdateAll` is designed for sorted `IndexedTable`s. For unsorted ones, use `updateAll` instead.");if(!b.length)return[];var a=this.B,c=this.m,f=this.p,h=this.t,l=[];b.forEach(function(b){var e=d(f,a(b));0!==h(b,c[e])?l.push(b):c[e]=b});return l},F:function(b){if(this.t)throw Error("`addAll` must not be called on an sorted `IndexedTable`. Use order-preserving `insertAll` instead.");if(b.length){var c=
this.B,d=this.m,f=this.p;b.forEach(function(b){var h=c(b);if(a.a.v(f,h))throw Error("The list already contains an element with id `"+h+"`. Did you mean to call `updateAll`?.");f[h]=d.push(b)-1})}},Wa:function(b){if(!this.t)throw Error("`insertAll` is designed for sorted `IndexedTable`s. For unsorted ones, use `addAll` instead.");if(b.length){var c=this.B,d=this.m,h=this.p,e=this.t;a.o.Ga(b,e);var k=0,g=[];b.forEach(function(b){b=f(d,e,b,k,d.length);g.push(b);k=b});k=0;this.m=l(c,d,h,g,function(a){var d=
b[k],f=c(d),l=a.length;a.push(d);h[f]=l;++k})}}});return e}(e,g))}(v,p);w=function(){function g(e,a,k){this.X=e||[];this.ea=a||[];this.da=k||[]}g.prototype={get size(){return this.X.length+this.ea.length+this.da.length},get empty(){return!this.size},I:function(e){this.empty||e(this)}};return g}();t={};q=function(g,e,a,k,h){function c(c,f,h){this.ia=c;this.g=f||new a(c.W);this.D=h||g.observable(new k);this.ya=g.observable(this.g.readOnly());this.L=null;this.n=g.pureComputed(function(){this.ya();this.L||
(this.L=this.g.map(this.r.s));return this.L}.bind(this));this.n.subscribe(function(){return this.L=null}.bind(this),null,"asleep")}c.prototype={get W(){return this.ia.W},get r(){return this.ia.r},get values(){return this.ya},get O(){return this.n},ja:function(a){this.L&&(a.X.forEach(this.r.s),this.L=this.g.map(this.r.Tb),a.da.forEach(this.r.q));this.ya.valueHasMutated()},xa:function(){this.n&&this.g.forEach(this.r.q)},aa:function(){this.ia.aa();this.ha()},N:function(a){return new h.ob(this,a)},Q:function(a){return new h.yb(this,
a)},Qa:function(a,c){return new h.kb(this,a,c)}};return c}(r,p,D,w,t);x=function(g,e,a){function k(h,c,d,f){a.call(this,{W:h,r:c},d,f);this.T=f.subscribe(function(a){this.ja(a)}.bind(this))}k.prototype=e.a.extend({},a.prototype,{aa:function(){},dispose:function(){this.T.dispose();this.xa()}});return k}(r,p,q);(function(g,e,a,k,h){function c(c,f){k.call(this,c);var h=g.observable(g.unwrap(f));this.ha=function(){return h(g.unwrap(f))};this.S=g.computed(function(){h();var c=g.unwrap(f);h(c);var b=this.g.J(),
c=this.ia.g.filter(c).J(),b=new a(c,[],b);this.g.clear();this.g.F(c);this.ja(b);b.I(this.D)}.bind(this));this.T=c.D.subscribe(function(c){var b;b=this.W;for(var d=this.g,h=g.unwrap(f),e=c.X.filter(h),l=[],k=c.da.filter(h),p=0,q=c.ea.length;p<q;p++){var u=c.ea[p],r=d.za(b(u));h(u)?r?l.push(u):e.push(u):r&&k.push(u)}b=new a(e,l,k);b.empty||(this.g.removeAll(b.da),this.g.ra(b.ea),this.g.F(b.X),this.ja(c),b.I(this.D))}.bind(this))}c.prototype=e.a.extend({},k.prototype,{dispose:function(){this.S.dispose();
this.T.dispose();this.xa()}});return h.ob=c})(r,p,w,q,t);(function(g,e,a,k){function h(c,d){a.call(this,c);this.g.F(c.g.J());var f=g.observable(g.unwrap(d));this.ha=function(){return f(g.unwrap(d))};this.S=g.computed(function(){f();var a=g.unwrap(d);f(a);this.g.hb(a)&&this.D.valueHasMutated()}.bind(this));this.T=c.D.subscribe(function(a){var c=this.g.jb(a.ea);this.g.removeAll(a.da.concat(c));this.g.Wa(a.X.concat(c));this.ja(a);this.D.valueHasMutated()}.bind(this))}h.prototype=e.a.extend({},a.prototype,
{N:function(){throw Error("Filtering a sorted view is not supported.");},Q:function(){throw Error("Sorting a sorted view is not supported.");},dispose:function(){this.S.dispose();this.T.dispose();this.xa()}});return k.yb=h})(r,p,q,t);(function(g,e,a,k){function h(c,d,f){function h(){return{offset:g.unwrap(d),f:g.unwrap(f)}}var e=c.r;this.wa=c;this.b=g.observable(a.ba());this.n=null;var b=c.W,m=g.observable(h());this.ha=function(){var b=m(),a=h();b.offset===a.offset&&b.f===a.f||m(a)};this.S=g.computed(function(){c.D();
m();var a=h();m(a);var d=c.g,f=Math.min(d.length,a.offset),k=Math.min(d.length,f+a.f),a=this.b.peek(),d=d.slice(f,k);a:if(a.length!==d.length)f=!0;else{for(f=a.length-1;0<=f;--f)if(b(a.get(f))!==b(d.get(f))){f=!0;break a}f=!1}f&&(this.b(d),this.n&&(this.n(this.b.peek().map(e.s)),a.forEach(e.q)))}.bind(this))}h.prototype={get values(){return this.b},get O(){this.n||(this.n=g.observable(this.values().map(this.wa.r.s)));return this.n},aa:function(){this.wa.aa();this.ha()},N:function(){throw Error("Filtering a clipped view is not supported.");
},Q:function(){throw Error("Sorting a clipped view is not supported.");},Qa:function(){throw Error("Clipping a clipped view is not supported.");},dispose:function(){this.S.dispose();this.n&&this.b().forEach(this.wa.r.q)}};return k.kb=h})(r,p,v,t);H={wb:x};t=function(g){function e(a,h,c){this.l=a;this.c=c?function(a,f){var e=h(f);try{return a(e)}finally{c(e)}}:function(a,c){return a(h(c))}}e.prototype={forEach:function(a){this.l.forEach(this.c.bind(null,a))},map:function(a){return new e(this,a)},reduce:function(a,
h){return this.l.reduce(function(c,d){return a(c,this.c(function(a){return a},d))}.bind(this),h)}};var a=e.prototype;g.a.extend(a,{forEach:a.forEach,map:a.map,reduce:a.reduce});return e}(p);E=function(g,e,a){function k(){return 0}function h(){return!0}function c(b,a){this.e=b;this.c=a}function d(b){this.c=b;this.l=b.G.subscribe(function(){throw Error("Illegal state: A non-optional view for this entry is still open.");})}function f(b,a,c){this.e=b;this.Qb=a;this.Rb=c;this.Sa=!1;this.u=a(c);b=b.Hb(this.value);
this.Z=b();this.Ba=g.observable({present:!0,observable:this.Z});this.l=b.subscribe(function(b){this.Ba({present:!!b,observable:b})}.bind(this))}function l(b,a,c,d){this.h=b||h;this.i=a||k;this.offset=c||0;this.f=d||0===d?d:Number.POSITIVE_INFINITY;this.C=Math.max(this.h===h?l.c:l.Ka,this.i===k?l.c:l.u,0===this.offset&&this.f===Number.POSITIVE_INFINITY?l.c:l.l)}function A(b,a,c){this.key=b;this.view=a;this.w=1;this.c=c}c.prototype={ab:function(b){return new d(this.Fa(b))},Fa:function(b){return new f(this.e,
this.c,b)},ib:function(b){return this.R(b).then(function(b){return new a(b,this.e.s.bind(this.e),this.e.q.bind(this.e))}.bind(this))},P:function(){throw Error("`"+this.constructor+"` does not implement `openView`.");},R:function(){throw Error("`"+this.constructor+"` does not implement `streamValues`.");},dispose:function(){throw Error("`"+this.constructor+"` does not implement `dispose`.");}};c.prototype=e.a.extend({},{openEntryView:c.prototype.ab,openOptionalEntryView:c.prototype.Fa,streamObservables:c.prototype.ib},
c.prototype);d.prototype={get value(){return this.c.value},get observable(){return this.c.observable},dispose:function(){this.l&&this.l.dispose();this.c.dispose()}};d.prototype=e.a.extend({},{get value(){return this.value},get observable(){return this.observable},dispose:d.prototype.dispose},d.prototype);f.prototype={c:function(){if(this.Sa)throw Error("Illegal state: Entry view was already disposed.");},get value(){this.c();return this.u=this.Qb(this.Rb)},get observable(){this.c();return this.Z},
get G(){this.c();return this.Ba},dispose:function(){this.c();this.Sa=!0;this.l&&(this.l.dispose(),this.e.q(this.u),this.u=this.Z=this.Ba=this.l=null)}};f.prototype=e.a.extend({},{get value(){return this.value},get observable(){return this.observable},get optionalObservable(){return this.G},dispose:f.prototype.dispose},f.prototype);l.c=0;l.Ka=1;l.u=2;l.l=3;l.Ta=function(b){return new l(b.h,b.i,b.offset,b.f)};l.prototype={$:function(b){return this.C===b.C&&this.h===b.h&&this.i===b.i&&this.offset===
b.offset&&this.f===b.f},cb:function(){if(0>=this.C)throw Error("Unsupported operation.");var b=[null,this.h,this.i].slice(0,this.C);return new (l.bind.apply(l,b))},Pa:function(){return 0===this.C?[this]:this.cb().Pa().concat([this])},Kb:function(b){var a=[[this.h],[this.i],[this.offset,this.f]][this.C-1];return(0,[function(b){return b.N},function(b){return b.Q},function(b){return b.Qa}][this.C-1])(b).apply(b,a)}};A.prototype={s:function(){if(0>=this.w)throw Error("Assertion error: Reference count at `"+
this.w+"`.");++this.w;return this},q:function(){0===--this.w&&this.c();return this}};c.fa=l;c.Ja=A;return c}(r,p,t);F=function(g,e){function a(a){this.V=a}a.prototype={forEach:function(a){this.V.forEach(a)},map:function(a){return new e(this,a)},reduce:function(a,c){return Promise.resolve(this.V.reduce(a,c))}};var k=a.prototype;g.a.extend(k,{forEach:k.forEach,map:k.map,reduce:k.reduce});return a}(p,t);t=function(g){function e(a){this.U=!1;(a&&a.observableProperties||[]).forEach(function(a){this.U=
this.U||{};this.U[a]=!0}.bind(this))}e.prototype={constructor:function(a){var e=this.U;if(!e)return a;var h={};Object.keys(a).forEach(function(c){h[c]=e&&e[c]?g.observable(a[c]):a[c]});return h},updater:function(a,e){var h=this.U;if(!h)return a;Object.keys(e).filter(function(a){return h&&h[a]}).forEach(function(c){return a[c](e[c])});return a},destructor:function(){}};return e}(r);z=function(g,e,a){function k(a){this.observable=a;this.G=g.observable(a);this.eb=1}return function(h,c){function d(a){if("string"!==
typeof a)throw l(a);if(e.a.v(b,a))return b[a];throw Error("No entry for id `"+a+"`.");}function f(a){var d=h(a);if("string"!==typeof d)throw l(d);Object.prototype.hasOwnProperty.call(b,d)?(d=b[d],++d.eb):(a=new k(c.constructor(a)),d=b[d]=a);return d}function l(a){throw Error("Illegal argument: Ids must be strings ('"+a+"' is of type '"+typeof a+"').");}function g(a){var b=a.observable;a.G(null);a.observable=null;c.destructor(b)}c=c||new a;var b={};this.s=function(a){return f(a).observable};this.Hb=
function(a){return f(a).G};this.q=function(a){a=h(a);var c=d(a);0===--c.eb&&(g(c),delete b[a])};this.Tb=function(a){return d(h(a)).observable};this.bb=function(a){a.forEach(function(a){var d=h(a);e.a.v(b,d)&&(d=b[d],d.observable||(d.observable=c.constructor(a),d.G(d.observable)))})};this.sa=function(a){a.forEach(function(a){var d=h(a);e.a.v(b,d)&&c.updater(b[d].observable,a)})};this.Xb=function(a){e.a.Da(b,function(b,d){var f=a(b);f?d.observable?c.updater(d.observable,f):(d.observable=c.constructor(f),
d.G(d.observable)):g(d)})};this.Ra=function(a){e.a.Da(b,function(b,c){a(b)&&g(c)})};this.dispose=function(){this.Ra(function(){return!0})}.bind(this)}}(r,p,t);q=function(g){var e,a,k;e=function(a){return function(c,d){return a.a.extend(c,{get stringifyable(){return d()}})}}(g);a=function(a,c){function d(){return 0}function f(a,b){return"string"===typeof a&&"string"===typeof b?a.localeCompare(b):a<=b?a<b?-1:0:1}function e(c,d){a.a.extend(c,{get onResultOf(){return this.ca},get reverse(){return this.reverse},
get callable(){return this.Y}},{get ca(){return function(a){return g(a,c)}},get reverse(){return function(){return d||b(c)}},get Y(){return c}})}function g(a,b){function d(c,f){return b(a(c),a(f))}e(d);c(d,function(){return{type:"by-function-comparator","function":a.stringifyable,comparator:b.stringifyable}});return d}function b(a){function b(c,d){return-a(c,d)}e(b,a);c(b,function(){return{type:"reversed-comparator",comparator:a.stringifyable}});return b}e(f);c(f,function(){return{type:"natural-comparator"}});
e(d);c(d,function(){return{type:"indifferent-comparator"}});return{Sb:d,c:f}}(g,e);k=function(a,c){function d(c){a.a.extend(c,{get callable(){return this.Y}},{get Y(){return c}})}return{Wb:function(a){function e(c){return c[a]}d(e);c(e,function(){return{type:"property-accessor",propertyName:a}});return e}}}(g,e);g=function(a,c){function d(){return!0}function f(){return!1}function e(c,d){a.a.extend(c,{get and(){return this.ka},get negate(){return this.Za},get onResultOf(){return this.ca},get or(){return this.na},
get callable(){return this.Y}},{get ka(){return function(a){return g([c,a])}},get Za(){return function(){return d||k(c)}},get ca(){return function(a){return b(a,c)}},get na(){return function(a){return I([c,a])}},get Y(){return c}})}function g(a){function b(c){for(var d=0,f=a.length;d<f;++d)if(!a[d](c))return!1;return!0}if(!a.length)return d;e(b);c(b,function(){return{type:"and-predicate",components:a.map(function(a){return a.stringifyable})}});return b}function b(a,b){function d(c){return b(a(c))}
e(d);c(d,function(){return{type:"by-function-predicate","function":a.stringifyable,predicate:b.stringifyable}});return d}function k(a){function b(c){return!a(c)}e(b,a);c(b,function(){return{type:"negated-predicate",predicate:a.stringifyable}});return b}function I(a){function b(c){for(var d=0,f=a.length;d<f;++d)if(a[d](c))return!0;return!1}if(!a.length)return f;e(b);c(b,function(){return{type:"or-predicate",components:a.map(function(a){return a.stringifyable})}});return b}e(f);c(f,function(){return{type:"always-false-predicate"}});
e(d);c(d,function(){return{type:"always-true-predicate"}});return{c:f,Jb:d,ka:g,l:function(a,b){function d(b){return a(b)}e(d);c(d,b);return d},na:I,Yb:function(a){function b(c){return a.test(c)}e(b);c(b,function(){return{type:"regular-expression-predicate",regularExpression:a.source,caseSensitive:!a.ignoreCase,multiline:a.multiline}});return b}}}(g,e);return function(a){return a}({M:a,la:k,H:g,Ub:e,ac:function(a,c){return"function"===typeof c||"object"===typeof c?c.stringifyable||c:c}})}(p);q=function(g,
e,a){function k(a,c,d,f){this.Eb=a;this.t=c;this.Db=d;this.Cb=f}k.prototype=e.a.extend({get predicate(){return this.h},get comparator(){return this.i},get offset(){return this.offset},get limit(){return this.f}},{get h(){return this.Eb},get i(){return this.t},get offset(){return this.Db},get f(){return this.Cb},normalize:function(){return new k(this.h||a.H.Jb,this.i||a.M.Sb,this.offset||0,this.f||0===this.f?this.f:Number.POSITIVE_INFINITY)},Ia:function(){return new k(g.unwrap(this.h),g.unwrap(this.i),
g.unwrap(this.offset),g.unwrap(this.f))},$:function(a){return this.h===a.h&&this.i===a.i&&this.offset===a.offset&&this.f===a.f}});return k}(r,p,q);q=function(g,e){function a(a,c,d){e.call(this,a,c,d)}var k={Xa:function(a){return new e(this.h,this.i,this.offset,a)}};a.prototype=g.a.extend({},e.prototype,k,{limitedTo:k.Xa});return a}(p,q);q=function(g,e){function a(a,c){e.call(this,a,c)}var k={$a:function(a){return new e(this.h,this.i,a)}};a.prototype=g.a.extend({},e.prototype,k,{offsetBy:k.$a});return a}(p,
q);q=function(g,e){function a(a){e.call(this,a)}var k={Q:function(a){return new e(this.h,a)}};a.prototype=g.a.extend({},e.prototype,k,{sortedBy:k.Q});return a}(p,q);q=function(g,e){function a(){e.call(this)}var k={N:function(a){return new e(a)}};a.prototype=g.a.extend({},e.prototype,k,{filteredBy:k.N});return a}(p,q);y=function(g,e){function a(){e.call(this)}a.prototype=g.a.extend({},e.prototype);return a}(p,q);q=function(){function g(b,e){e=e||new l(b);var g=new f(b);c.call(this,e,function(a){return g.Ua(a)});
this.ga=b;this.e=e;this.b=g;this.K=a.observable(new d);this.k=[];var k=new h.wb(this.ga,this.e,this.b,this.K);this.Fb=this.La(new c.fa,k);this.A=a.pureComputed(function(){return k.values().length})}function e(b,d){this.c=b;this.u=d;this.A=a.pureComputed(function(){return b.values().length});this.l=a.pureComputed(function(){return(k.o.oa(d,function(a){return a.key.C===c.fa.Ka})||d[0]).view.values().length})}var a=r,k=p,h=H,c=E,d=w,f=D,l=z;g.prototype={get size(){return this.A},La:function(a,d){var f=
new c.Ja(a,d,function(){return this.k.splice(this.k.indexOf(f),1)}.bind(this));this.k.push(f);return f},Bb:function(a){var c=k.o.oa(this.k,function(c){return a.$(c.key)});if(c)return c.s();var d=a.cb(),c=k.o.gb(this.k,function(a){return d.$(a.key)}).view,c=a.Kb(c);return this.La(a,c)},Gb:function(a){this.b.F(a);(new d(a)).I(this.K);this.e.bb(a)},Ib:function(a){var c=[],f=[];a.forEach(function(a){return(this.b.contains(a)?f:c).push(a)}.bind(this));this.b.F(c);this.b.ra(f);(new d(c,f)).I(this.K);this.e.bb(c);
this.e.sa(f)},P:function(a){a=(a||function(a){return a})(new y);a=c.fa.Ta(a).Pa().map(function(a){return this.Bb(a)}.bind(this));var d=a[a.length-1].view;d.aa();return new e(d,a)},Zb:function(a){this.b.removeAll(a);(new d([],[],a)).I(this.K);this.e.Ra(function(a){return!this.b.za(a)}.bind(this))},$b:function(a){var c=this.b.J();this.b.clear();this.b.F(a);(new d(a,[],c)).I(this.K);this.e.Xb(function(a){return this.b.bc(a)}.bind(this))},R:function(a){a=this.P(a);try{return Promise.resolve(new F(a.values.peek().slice()))}finally{a.dispose()}},
sa:function(a){this.b.ra(a);(new d([],a)).I(this.K);this.e.sa(a)},dispose:function(){this.Fb.q();this.e.dispose();if(this.k.length){var a=this.k.length,c=this.k.reduce(function(a,b){return a+b.w},0);window.console.warn("Some views were not or are not yet disposed ("+a+" views, "+c+" references).")}}};g.prototype=k.a.extend({},c.prototype,{get size(){return this.size},addEntries:g.prototype.Gb,dispose:g.prototype.dispose,addOrUpdateEntries:g.prototype.Ib,openView:g.prototype.P,removeEntries:g.prototype.Zb,
replaceEntries:g.prototype.$b,streamValues:g.prototype.R,updateEntries:g.prototype.sa},g.prototype);var q=a.pureComputed(function(){return!1});e.prototype={get Aa(){return q},get Ca(){return this.l},get Ea(){return a.pureComputed(function(){return{}})},get O(){return this.c.O},get size(){return this.A},get values(){return this.c.values},dispose:function(){this.u.forEach(function(a){a.q()})}};e.prototype=k.a.extend({get dirty(){return this.Aa},get filteredSize(){return this.Ca},get metadata(){return this.Ea},
get observables(){return this.O},get size(){return this.size},get values(){return this.values},dispose:e.prototype.dispose},e.prototype);return g}({});x=function(){function g(f,e,g){g=g||new c(f);var b={};h.call(this,g,function(a){if(!d(b,a))throw Error("No known entry with id `"+a+"`.");return b[a].value});this.ga=f;this.e=g;this.Na=e;this.b=b;this.A=a.observable(0);this.Ab=a.pureComputed(function(){return this.A()}.bind(this));this.k=[]}function e(c,d,e){function b(a){if(a.h!==w||a.i!==x)return!1;
for(var b=0,c=u.length;b<c;++b){var d=B[b];if(u[b]<=a.offset&&d>=a.offset+a.f)return!0}return!1}function g(a,b){if(a.h!==w||a.i!==x){var c=a.h,d=a.i;v=[];u=[];B=[];w=c;x=d}var d=c=a.offset,f=c+a.f,e,h,k;h=e=0;for(k=u.length;e<k;++e){var l=u[h]=u[e],m=B[h]=B[e];d<=m&&f>=l?(d=Math.min(l,d),f=Math.max(m,f)):++h}u.length=B.length=h;u.push(d);B.push(f>=q().filteredSize?Number.POSITIVE_INFINITY:f);e=0;for(k=b.length;e<k;++e)v[c+e]=b[e]}var h=a.observable(!1),p=a.observable(!1),q=a.observable({unfilteredSize:c.size.peek(),
filteredSize:0}),r=k.ba(),t=a.observable(),v=[],u=[],B=[],w=null,x=null,z=a.pureComputed(function(){if(h.peek())return h();var a=d.Ia().normalize();if(b(a))return t(v.slice(a.offset,a.offset+a.f));p(!0);h(!0);window.setTimeout(function(){if(!a.$(d.Ia().normalize()))return h(!1);c.Na.issue(a).then(function(b){var d=[];b.values.reduce(function(a,b){return d.push(b)});t(d);delete b.values;c.A(b.unfilteredSize);q(b);g(a,d)}).then(function(){p(!1);h(!1)},function(){h(!1)})})}),y=a.pureComputed(function(){z();
var a=t(),a=k.ba(a);C?(C=a.map(function(a){c.Ma(a);return c.e.s(a)}),r.forEach(function(a){c.Oa(a);c.e.q(a)})):(a.forEach(c.Ma.bind(c)),r.forEach(c.Oa.bind(c)));return r=a});this.b=y;var C=null;this.n=a.pureComputed(function(){y();C||(C=r.map(c.e.s));return C});this.n.subscribe(function(){return C=null},null,"asleep");this.l=a.pureComputed(function(){return p()});this.Z=a.pureComputed(function(){return q()});this.c=a.pureComputed(function(){return q().filteredSize});this.A=a.pureComputed(function(){return y().length});
this.u=function(){z.dispose();e()}}var a=r,k=v,h=E,c=z,d=p.a.v;g.prototype={get size(){return this.Ab},Ma:function(a){var c=this.ga(a);d(this.b,c)?(c=this.b[c],++c.w,c.value=a):this.b[c]={w:1,value:a}},Oa:function(a){a=this.ga(a);if(!d(this.b,a))throw Error("Assertion error: Value with id `"+a+"` was expected to be referenced.");0===--this.b[a].w&&delete this.b[a]},P:function(a){a=(a||function(a){return a})(new y);var c=h.fa.Ta(a),d=p.o.oa(this.k,function(a){return c.$(a.key)});if(d)return d.s().view;
a=new e(this,a,function(){return b.q()});var b=new h.Ja(c,a,function(){return this.k.splice(this.k.indexOf(b),1)}.bind(this));this.k.push(b);return a},R:function(a){a=(a||function(a){return a})(new y);return this.Na.issue(a.Ia().normalize()).then(function(a){return a.values})},dispose:function(){this.e.dispose();if(this.k.length){var a=this.k.length,c=this.k.reduce(function(a,b){return a+b.w},0);window.console.warn("Some views were not or are not yet disposed ("+a+" views, "+c+" references).")}}};
g.prototype=p.a.extend({},h.prototype,{get size(){return this.size},dispose:g.prototype.dispose,openView:g.prototype.P,streamValues:g.prototype.R},g.prototype);e.prototype={get Aa(){return this.l},get Ca(){return this.c},get Ea(){return this.Z},get O(){return this.n},get size(){return this.A},get values(){return this.b},dispose:function(){this.u()}};e.prototype=p.a.extend({},{get dirty(){return this.Aa},get filteredSize(){return this.Ca},get metadata(){return this.Ea},get observables(){return this.O},
get size(){return this.size},get values(){return this.values},dispose:e.prototype.dispose},e.prototype);return g}({});return function(g){return g}(function(g,e,a,k,h){return{ClientSideDataSource:g,DefaultObservableStateTransitioner:e,ObservableEntries:a,ServerSideDataSource:k,streams:h}}(q,t,z,x,function(g,e){return{streamArray:function(a){return new e(g.ba(a))}}}(v,F)))}"function"===typeof define&&define.amd?define(["knockout"],G):window["ko-data-source"]=G(window.ko);