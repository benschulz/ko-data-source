/*
 Copyright (c) 2015, Ben Schulz
 License: BSD 3-clause (http://opensource.org/licenses/BSD-3-Clause)
*/
var n;
function F(u){var p,w,C,y,t,q,z,G,D,E,A,B;p=function(){var d;d=function(){function e(a,e){return Object.prototype.hasOwnProperty.call(a,e)}return{Lb:function(a,e){if(a===e)return!0;var l=!!e&&"function"===typeof e.valueOf;return!!a&&"function"===typeof a.valueOf&&l&&a.valueOf()===e.valueOf()},extend:function(a,e){Array.prototype.slice.call(arguments,1).forEach(function(l){for(var g=Object.keys(l),c=0,f=g.length;c<f;c++){var k=g[c],r=Object.getOwnPropertyDescriptor(l,k);void 0!==r&&r.enumerable&&Object.defineProperty(a,
k,r)}});return a},Ca:function(a,d){for(var l in a)e(a,l)&&d(l,a[l])},v:e,Vb:function(a,d){var l={},g;for(g in a)e(a,g)&&(l[g]=d(a[g],g,a));return l}}}();return function(e){return e}(function(e,a,d){return{o:e,a:a,pa:d}}(function(e){function a(c){return c.filter(function(f,k,c){return c.lastIndexOf(f)===k})}function d(c,f){for(var k=c.length,a=-1,b=0;b<k;++b)if(f(c[b])){if(0<=a)throw Error("Multiple elements match the predicate.");a=b}return a}function l(c,f){return c&&"function"===typeof c.valueOf&&
f&&"function"===typeof f.valueOf?c.valueOf()<=f.valueOf()?c.valueOf()<f.valueOf()?-1:0:1:c<=f?c<f?-1:0:1}function g(c,f){var k=c.length,a=Array(k),b=Array(k),m;for(m=0;m<k;++m)a[m]=m,b[m]=c[m];m=c;c=b;b=m;a.sort(function(b,m){return f(c[b],c[m])||b-m});for(m=0;m<k;++m)b[m]=c[a[m]];return b}return{contains:function(c,f){return 0<=c.indexOf(f)},Ob:function(c){if(50<c.length){for(var f=c.length,k={},g,b=0;b<f;++b)if(g=c[b],"string"===typeof g)if(e.v(k,g))break;else k[g]=!0;else if(c.lastIndexOf(g)!==
b)break;if(!(b>=f)){for(var m=c.slice(0,b);b<f;++b)g=c[b],"string"===typeof g?e.v(k,g)||(k[g]=!0,m.push(g)):c.lastIndexOf(g)===b&&m.push(g);c=m}}else c=a(c);return c},Pb:function(c,f){return Array.prototype.concat.apply([],c.map(f))},hb:function(c,f){var k=d(c,f);if(0>k)throw Error("None of the elements matches the predicate.");return c[k]},na:function(c,f){var k=d(c,f);return 0<=k?c[k]:null},Fa:function(c,f){var k=f||l;window.chrome?k=g(c,k):(c.sort(k),k=c);return k}}}(d),d,{Mb:function(e){return e.replace(/([A-Z])/g,
function(a){return"-"+a.toLowerCase()})},Nb:function(e){return e.replace(/-([a-z])/g,function(a){return a[1].toUpperCase()})},format:function(e){var a=arguments;return e.replace(/{(\d+)}/g,function(e,l){var g=parseInt(l,10)+1;return typeof a.length<=g?e:a[g]})}}))}();w=function(d){return function(e){return e}(function(e){function a(a){var c={get length(){return this.length},contains:function(f){return 0<=this.Ga(f)},filter:function(f){for(var a=this.length,c=[],b=0;b<a;++b){var m=this.get(b);f(m,
b,this)&&c.push(m)}return new d(c)},forEach:function(f){for(var c=this.length,a=0;a<c;++a)f(this.get(a),a,this)},get:function(f){return this.get(f)},map:function(f){for(var a=this.length,c=Array(a),b=0;b<a;++b)c[b]=f(this.get(b),b,this);return new d(c)},readOnly:function(){return new l(this)},reduce:function(f,a){var c=1<arguments.length,b=this.length;if(!c&&0===b)throw new TypeError("An empty list can not be reduced, specify an initial value.");for(var m=c?a:this.get(0),c=c?0:1;c<b;++c)m=f(m,this.get(c));
return m},slice:function(f,c){var a=this.length;f=0>=arguments.length?0:0<=f?f:a+f;c=1>=arguments.length?a:0<=c?c:a+c;for(var a=c-f,b=Array(a),m=0;m<a;++m)b[m]=this.get(f+m);return new d(b)},J:function(){for(var c=this.length,a=Array(c),g=0;g<c;++g)a[g]=this.get(g);return a},Ga:function(c){for(var a=this.length,g=0;g<a;++g)if(this.get(g)===c)return g;return-1}};return e.a.extend(c,{get length(){return this.length},contains:c.contains,filter:c.filter,forEach:c.forEach,get:function(c){return this.get(c)},
map:c.map,readOnly:c.readOnly,reduce:c.reduce,slice:c.slice,toArray:c.J,tryFirstIndexOf:c.Ga},a)}function d(a){this.ua=a}function l(a){this.V=a}d.prototype=a({get length(){return this.ua.length},get:function(a){return this.ua[a]},J:function(){return this.ua.slice()}});l.prototype=a({get length(){return this.V.length},get:function(a){return this.V.get(a)}});return{aa:function(a){return new d(a||[])},Za:a}}(d))}(p);C=function(d,e){return function(a){return a}(function(a,d){function l(b){if("string"!==
typeof b)throw Error("Ids must be strings. (given: `"+b+"`, type: `"+typeof b+"`)");return b}function g(b,m){return a.a.v(b,l(m))?b[m]:-1}function c(b,m){var a=g(b,m);if(0>a)throw Error("No element with id `"+m+"`.");return a}function f(b,a,c,g,k){if(g>=k)return g;var d=Math.floor((g+k)/2);return 0>a(c,b[d])?f(b,a,c,g,d):f(b,a,c,d+1,k)}function k(b,a,c,f,g){function k(f,g){var e=d.length,l=a.slice(f,g);d=d.concat(l);l.forEach(function(a){c[b(a)]=e;++e})}var d=[],e=0;f.forEach(function(b){k(e,b);e=
b;g(d)});k(e,a.length);return d}function e(b){this.C=function(a){return l(b(a))};this.m=[];this.p={};this.u=null}e.prototype=d.Za({get length(){return this.m.length},get:function(b){return this.m[b]},Va:function(b){return this.m[c(this.p,b)]},bc:function(b){b=g(this.p,b);return 0<=b?this.m[b]:null},clear:function(){this.m=[];this.p={}},contains:function(b){b=(0,this.C)(b);return 0<=g(this.p,b)},ya:function(b){return 0<=g(this.p,b)},removeAll:function(b){this.gb(b.map(this.C))},gb:function(b){if(b.length){var a=
this.C,f=this.m,g=this.p;b=b.map(function(b){return c(g,b)+1});b.sort(function(b,a){return b-a});this.m=k(a,f,g,b,function(b){b=b.pop();b=a(b);delete g[b]})}},ib:function(b){var c=this.C,f=this.m,g=this.p;this.u=b;a.o.Fa(f,b);b=!1;for(var d=0;d<f.length;++d){var k=c(f[d]);b=b||g[k]!==d;g[k]=d}return b},qa:function(b){if(this.u)throw Error("`updateAll` must not be called on a sorted `IndexedTable`. Use a combination of order-preserving `tryUpdateAll`, `removeAll` and `insertAll` instead.");if(b.length){var a=
this.C,f=this.m,g=this.p;b.forEach(function(b){var d=c(g,a(b));f[d]=b})}},kb:function(b){if(!this.u)throw Error("`tryUpdateAll` is designed for sorted `IndexedTable`s. For unsorted ones, use `updateAll` instead.");if(!b.length)return[];var a=this.C,f=this.m,g=this.p,d=this.u,k=[];b.forEach(function(b){var e=c(g,a(b));0!==d(b,f[e])?k.push(b):f[e]=b});return k},G:function(b){if(this.u)throw Error("`addAll` must not be called on an sorted `IndexedTable`. Use order-preserving `insertAll` instead.");if(b.length){var c=
this.C,f=this.m,g=this.p;b.forEach(function(b){var d=c(b);if(a.a.v(g,d))throw Error("The list already contains an element with id `"+d+"`. Did you mean to call `updateAll`?.");g[d]=f.push(b)-1})}},Xa:function(b){if(!this.u)throw Error("`insertAll` is designed for sorted `IndexedTable`s. For unsorted ones, use `addAll` instead.");if(b.length){var c=this.C,g=this.m,d=this.p,e=this.u;a.o.Fa(b,e);var l=0,h=[];b.forEach(function(b){b=f(g,e,b,l,g.length);h.push(b);l=b});l=0;this.m=k(c,g,d,h,function(a){var f=
b[l],g=c(f),k=a.length;a.push(f);d[g]=k;++l})}}});return e}(e,d))}(w,p);y=function(){function d(d,a,h){this.X=d||[];this.da=a||[];this.ca=h||[]}d.prototype={get size(){return this.X.length+this.da.length+this.ca.length},get empty(){return!this.size},I:function(d){this.empty||d(this)}};return d}();t={};q=function(d,e,a,h,l){function g(c,f,g){this.ha=c;this.g=f||new a(c.W);this.F=g||d.observable(new h);this.xa=d.observable(this.g.readOnly());this.L=null;this.n=d.pureComputed(function(){this.xa();this.L||
(this.L=this.g.map(this.r.s));return this.L}.bind(this));this.n.subscribe(function(){return this.L=null}.bind(this),null,"asleep")}g.prototype={get W(){return this.ha.W},get r(){return this.ha.r},get values(){return this.xa},get P(){return this.n},ia:function(a){this.L&&(a.X.forEach(this.r.s),this.L=this.g.map(this.r.Tb),a.ca.forEach(this.r.q));this.xa.valueHasMutated()},wa:function(){this.n&&this.g.forEach(this.r.q)},$:function(){this.ha.$();this.ga()},O:function(a){return new l.pb(this,a)},R:function(a){return new l.yb(this,
a)},Ra:function(a,f){return new l.lb(this,a,f)}};return g}(u,p,C,y,t);z=function(d,e,a){function h(d,g,c,f){a.call(this,{W:d,r:g},c,f);this.U=f.subscribe(function(a){this.ia(a)}.bind(this))}h.prototype=e.a.extend({},a.prototype,{$:function(){},dispose:function(){this.U.dispose();this.wa()}});return h}(u,p,q);(function(d,e,a,h,l){function g(c,f){h.call(this,c);var g=d.observable(d.unwrap(f));this.ga=function(){return g(d.unwrap(f))};this.T=d.computed(function(){g();var c=d.unwrap(f);g(c);var b=this.g.J(),
c=this.ha.g.filter(c).J(),b=new a(c,[],b);this.g.clear();this.g.G(c);this.ia(b);b.I(this.F)}.bind(this));this.U=c.F.subscribe(function(c){var b;b=this.W;for(var g=this.g,e=d.unwrap(f),k=c.X.filter(e),l=[],h=c.ca.filter(e),p=0,q=c.da.length;p<q;p++){var x=c.da[p],I=g.ya(b(x));e(x)?I?l.push(x):k.push(x):I&&h.push(x)}b=new a(k,l,h);b.empty||(this.g.removeAll(b.ca),this.g.qa(b.da),this.g.G(b.X),this.ia(c),b.I(this.F))}.bind(this))}g.prototype=e.a.extend({},h.prototype,{dispose:function(){this.T.dispose();
this.U.dispose();this.wa()}});return l.pb=g})(u,p,y,q,t);(function(d,e,a,h){function l(g,c){a.call(this,g);this.g.G(g.g.J());var f=d.observable(d.unwrap(c));this.ga=function(){return f(d.unwrap(c))};this.T=d.computed(function(){f();var a=d.unwrap(c);f(a);this.g.ib(a)&&this.F.valueHasMutated()}.bind(this));this.U=g.F.subscribe(function(a){var c=this.g.kb(a.da);this.g.removeAll(a.ca.concat(c));this.g.Xa(a.X.concat(c));this.ia(a);this.F.valueHasMutated()}.bind(this))}l.prototype=e.a.extend({},a.prototype,
{O:function(){throw Error("Filtering a sorted view is not supported.");},R:function(){throw Error("Sorting a sorted view is not supported.");},dispose:function(){this.T.dispose();this.U.dispose();this.wa()}});return h.yb=l})(u,p,q,t);(function(d,e,a,h){function l(g,c,f){function e(){return{offset:d.unwrap(c),i:d.unwrap(f)}}var l=g.r;this.va=g;this.c=d.observable(a.aa());this.n=null;var b=g.W,m=d.observable(e());this.ga=function(){var b=m(),a=e();b.offset===a.offset&&b.i===a.i||m(a)};this.T=d.computed(function(){g.F();
m();var a=e();m(a);var c=g.g,f=Math.min(c.length,a.offset),d=Math.min(c.length,f+a.i),a=this.c.peek(),c=c.slice(f,d);a:if(a.length!==c.length)f=!0;else{for(f=a.length-1;0<=f;--f)if(b(a.get(f))!==b(c.get(f))){f=!0;break a}f=!1}f&&(this.c(c),this.n&&(this.n(this.c.peek().map(l.s)),a.forEach(l.q)))}.bind(this))}l.prototype={get values(){return this.c},get P(){this.n||(this.n=d.observable(this.values().map(this.va.r.s)));return this.n},$:function(){this.va.$();this.ga()},O:function(){throw Error("Filtering a clipped view is not supported.");
},R:function(){throw Error("Sorting a clipped view is not supported.");},Ra:function(){throw Error("Clipping a clipped view is not supported.");},dispose:function(){this.T.dispose();this.n&&this.c().forEach(this.va.r.q)}};return h.lb=l})(u,p,w,t);G={wb:z};t=function(d){function e(a,d,g){this.f=a;this.b=g?function(a,f){var e=d(f);try{return a(e)}finally{g(e)}}:function(a,f){return a(d(f))}}e.prototype={forEach:function(a){this.f.forEach(this.b.bind(null,a))},map:function(a){return new e(this,a)},reduce:function(a,
d){return this.f.reduce(function(g,c){return a(g,this.b(function(a){return a},c))}.bind(this),d)}};var a=e.prototype;d.a.extend(a,{forEach:a.forEach,map:a.map,reduce:a.reduce});return e}(p);D=function(d,e,a){function h(){return 0}function l(){return!0}function g(b,a){this.e=b;this.b=a}function c(b){this.f=b;this.b=null}function f(b,a,c){this.e=b;this.Qb=a;this.Rb=c;this.Ta=!1;this.t=this.b=this.f=this.Aa=null}function k(b,a,c,f){this.k=b||l;this.l=a||h;this.offset=c||0;this.i=f||0===f?f:Number.POSITIVE_INFINITY;
this.D=Math.max(this.k===l?k.b:k.La,this.l===h?k.b:k.t,0===this.offset&&this.i===Number.POSITIVE_INFINITY?k.b:k.f)}function r(b,a,c){this.key=b;this.view=a;this.A=1;this.b=c}g.prototype={bb:function(b){return new c(this.Ea(b))},Ea:function(b){return new f(this.e,this.b,b)},jb:function(b){return this.S(b).then(function(b){return new a(b,this.e.s.bind(this.e),this.e.q.bind(this.e))}.bind(this))},Q:function(){throw Error("`"+this.constructor+"` does not implement `openView`.");},S:function(){throw Error("`"+
this.constructor+"` does not implement `streamValues`.");},dispose:function(){throw Error("`"+this.constructor+"` does not implement `dispose`.");}};g.prototype=e.a.extend({},{openEntryView:g.prototype.bb,openOptionalEntryView:g.prototype.Ea,streamObservables:g.prototype.jb},g.prototype);c.prototype={get value(){return this.f.value},get observable(){this.b||(this.b=this.f.w.subscribe(function(){throw Error("Illegal state: A non-optional view for this entry is still open.");}));return this.f.observable},
dispose:function(){this.b&&this.b.dispose();this.f.dispose()}};c.prototype=e.a.extend({},{get value(){return this.value},get observable(){return this.observable},dispose:c.prototype.dispose},c.prototype);f.prototype={N:function(){if(this.Ta)throw Error("Illegal state: Entry view was already disposed.");},get value(){this.N();return this.Aa=this.Qb(this.Rb)},get observable(){this.N();return(this.f||this.w)&&this.f},get w(){this.N();if(this.b)return this.b;var b=this.e.Hb(this.value);this.f=b();this.b=
d.observable({present:!0,observable:this.f});this.t=b.subscribe(function(b){this.b({present:!!b,observable:b})}.bind(this));return this.b},dispose:function(){this.N();this.Ta=!0;this.t&&(this.t.dispose(),this.e.q(this.Aa),this.Aa=this.f=this.b=this.t=null)}};f.prototype=e.a.extend({},{get value(){return this.value},get observable(){return this.observable},get optionalObservable(){return this.w},dispose:f.prototype.dispose},f.prototype);k.b=0;k.La=1;k.t=2;k.f=3;k.Ua=function(b){return new k(b.k,b.l,
b.offset,b.i)};k.prototype={Z:function(b){return this.D===b.D&&this.k===b.k&&this.l===b.l&&this.offset===b.offset&&this.i===b.i},eb:function(){if(0>=this.D)throw Error("Unsupported operation.");var b=[null,this.k,this.l].slice(0,this.D);return new (k.bind.apply(k,b))},Qa:function(){return 0===this.D?[this]:this.eb().Qa().concat([this])},Kb:function(b){var a=[[this.k],[this.l],[this.offset,this.i]][this.D-1];return(0,[function(b){return b.O},function(b){return b.R},function(b){return b.Ra}][this.D-
1])(b).apply(b,a)}};r.prototype={s:function(){if(0>=this.A)throw Error("Assertion error: Reference count at `"+this.A+"`.");++this.A;return this},q:function(){0===--this.A&&this.b();return this}};g.ea=k;g.Ka=r;return g}(u,p,t);E=function(d,e){function a(a){this.V=a}a.prototype={forEach:function(a){this.V.forEach(a)},map:function(a){return new e(this,a)},reduce:function(a,g){return Promise.resolve(this.V.reduce(a,g))}};var h=a.prototype;d.a.extend(h,{forEach:h.forEach,map:h.map,reduce:h.reduce});return a}(p,
t);t=function(d){return function(){var e={};Array.prototype.slice.call(arguments).forEach(function(a){e[a]=!0});this.constructor=function(a){var h={};Object.keys(a).forEach(function(l){h[l]=e[l]?a[l]:d.observable(a[l])});return h};this.Ia=function(a,d){Object.keys(d).filter(function(a){return!e[a]}).forEach(function(e){return a[e](d[e])});return a}}}(u);A=function(d,e,a){function h(a){this.observable=a;this.w=d.observable(a);this.fb=1}return function(d,g){function c(b){if("string"!==typeof b)throw k(b);
if(e.a.v(r,b))return r[b];throw Error("No entry for id `"+b+"`.");}function f(b){var a=d(b);if("string"!==typeof a)throw k(a);Object.prototype.hasOwnProperty.call(r,a)?(a=r[a],++a.fb):(b=new h(g.constructor(b)),a=r[a]=b);return a}function k(b){throw Error("Illegal argument: Ids must be strings ('"+b+"' is of type '"+typeof b+"').");}g=g||new a;var r={};this.s=function(b){return f(b).observable};this.Hb=function(b){return f(b).w};this.q=function(b){b=d(b);0===--c(b).fb&&delete r[b]};this.Tb=function(b){return c(d(b)).observable};
this.cb=function(b){b.forEach(function(b){var a=d(b);e.a.v(r,a)&&(a=r[a],a.observable=g.constructor(b),a.w(a.observable))})};this.ra=function(b){b.forEach(function(b){var a=d(b);e.a.v(r,a)&&g.Ia(r[a].observable,b)})};this.Xb=function(b){e.a.Ca(r,function(a,c){var f=b(a);f?c.observable?g.Ia(c.observable,f):(c.observable=g.constructor(f),c.w(c.observable)):c.w(null)})};this.Sa=function(b){e.a.Ca(r,function(a,c){b(a)&&c.w(null)})};this.dispose=function(){this.Sa(function(){return!0})}.bind(this)}}(u,
p,t);q=function(d){var e,a,h;e=function(a){return function(d,c){return a.a.extend(d,{get stringifyable(){return c()}})}}(d);a=function(a,d){function c(){return 0}function f(b,a){return"string"===typeof b&&"string"===typeof a?b.localeCompare(a):b<=a?b<a?-1:0:1}function e(c,f){a.a.extend(c,{get onResultOf(){return this.ba},get reverse(){return this.reverse},get callable(){return this.Y}},{get ba(){return function(b){return h(b,c)}},get reverse(){return function(){return f||b(c)}},get Y(){return c}})}
function h(b,a){function c(f,d){return a(b(f),b(d))}e(c);d(c,function(){return{type:"by-function-comparator","function":b.stringifyable,comparator:a.stringifyable}});return c}function b(b){function a(c,f){return-b(c,f)}e(a,b);d(a,function(){return{type:"reversed-comparator",comparator:b.stringifyable}});return a}e(f);d(f,function(){return{type:"natural-comparator"}});e(c);d(c,function(){return{type:"indifferent-comparator"}});return{Sb:c,b:f}}(d,e);h=function(a,d){function c(c){a.a.extend(c,{get callable(){return this.Y}},
{get Y(){return c}})}return{Wb:function(a){function e(c){return c[a]}c(e);d(e,function(){return{type:"property-accessor",propertyName:a}});return e}}}(d,e);d=function(a,d){function c(){return!0}function f(){return!1}function e(c,f){a.a.extend(c,{get and(){return this.ja},get negate(){return this.$a},get onResultOf(){return this.ba},get or(){return this.ma},get callable(){return this.Y}},{get ja(){return function(b){return h([c,b])}},get $a(){return function(){return f||m(c)}},get ba(){return function(a){return b(a,
c)}},get ma(){return function(b){return H([c,b])}},get Y(){return c}})}function h(b){function a(c){for(var f=0,d=b.length;f<d;++f)if(!b[f](c))return!1;return!0}if(!b.length)return c;e(a);d(a,function(){return{type:"and-predicate",components:b.map(function(b){return b.stringifyable})}});return a}function b(b,a){function c(f){return a(b(f))}e(c);d(c,function(){return{type:"by-function-predicate","function":b.stringifyable,predicate:a.stringifyable}});return c}function m(b){function a(c){return!b(c)}
e(a,b);d(a,function(){return{type:"negated-predicate",predicate:b.stringifyable}});return a}function H(b){function a(c){for(var f=0,d=b.length;f<d;++f)if(b[f](c))return!0;return!1}if(!b.length)return f;e(a);d(a,function(){return{type:"or-predicate",components:b.map(function(b){return b.stringifyable})}});return a}e(f);d(f,function(){return{type:"always-false-predicate"}});e(c);d(c,function(){return{type:"always-true-predicate"}});return{b:f,Jb:c,ja:h,f:function(b,a){function c(a){return b(a)}e(c);
d(c,a);return c},ma:H,Yb:function(b){function a(c){return b.test(c)}e(a);d(a,function(){return{type:"regular-expression-predicate",regularExpression:b.source,caseSensitive:!b.ignoreCase,multiline:b.multiline}});return a}}}(d,e);return function(a){return a}({M:a,ka:h,H:d,Ub:e,ac:function(a,d){return"function"===typeof d||"object"===typeof d?d.stringifyable||d:d}})}(p);q=function(d,e,a){function h(a,d,c,f){this.Eb=a;this.u=d;this.Db=c;this.Cb=f}h.prototype=e.a.extend({get predicate(){return this.k},
get comparator(){return this.l},get offset(){return this.offset},get limit(){return this.i}},{get k(){return this.Eb},get l(){return this.u},get offset(){return this.Db},get i(){return this.Cb},normalize:function(){return new h(this.k||a.H.Jb,this.l||a.M.Sb,this.offset||0,this.i||0===this.i?this.i:Number.POSITIVE_INFINITY)},Ha:function(){return new h(d.unwrap(this.k),d.unwrap(this.l),d.unwrap(this.offset),d.unwrap(this.i))},Z:function(a){return this.k===a.k&&this.l===a.l&&this.offset===a.offset&&
this.i===a.i}});return h}(u,p,q);q=function(d,e){function a(a,d,c){e.call(this,a,d,c)}var h={Ya:function(a){return new e(this.k,this.l,this.offset,a)}};a.prototype=d.a.extend({},e.prototype,h,{limitedTo:h.Ya});return a}(p,q);q=function(d,e){function a(a,d){e.call(this,a,d)}var h={ab:function(a){return new e(this.k,this.l,a)}};a.prototype=d.a.extend({},e.prototype,h,{offsetBy:h.ab});return a}(p,q);q=function(d,e){function a(a){e.call(this,a)}var h={R:function(a){return new e(this.k,a)}};a.prototype=
d.a.extend({},e.prototype,h,{sortedBy:h.R});return a}(p,q);q=function(d,e){function a(){e.call(this)}var h={O:function(a){return new e(a)}};a.prototype=d.a.extend({},e.prototype,h,{filteredBy:h.O});return a}(p,q);B=function(d,e){function a(){e.call(this)}a.prototype=d.a.extend({},e.prototype);return a}(p,q);q=function(){function d(b,d){d=d||new k(b);var e=new f(b);g.call(this,d,function(a){return e.Va(a)});this.fa=b;this.e=d;this.c=e;this.K=a.observable(new c);this.j=[];var h=new l.wb(this.fa,this.e,
this.c,this.K);this.Fb=this.Ma(new g.ea,h);this.B=a.pureComputed(function(){return h.values().length})}function e(b,c){this.b=b;this.t=c;this.B=a.pureComputed(function(){return b.values().length});this.f=a.pureComputed(function(){return(h.o.na(c,function(a){return a.key.D===g.ea.La})||c[0]).view.values().length})}var a=u,h=p,l=G,g=D,c=y,f=C,k=A;d.prototype={get size(){return this.B},Ma:function(a,c){var d=new g.Ka(a,c,function(){return this.j.splice(this.j.indexOf(d),1)}.bind(this));this.j.push(d);
return d},Bb:function(a){var c=h.o.na(this.j,function(c){return a.Z(c.key)});if(c)return c.s();var d=a.eb(),c=h.o.hb(this.j,function(a){return d.Z(a.key)}).view,c=a.Kb(c);return this.Ma(a,c)},Gb:function(a){this.c.G(a);(new c(a)).I(this.K);this.e.cb(a)},Ib:function(a){var d=[],f=[];a.forEach(function(a){return(this.c.contains(a)?f:d).push(a)}.bind(this));this.c.G(d);this.c.qa(f);(new c(d,f)).I(this.K);this.e.cb(d);this.e.ra(f)},Q:function(a){a=(a||function(a){return a})(new B);a=g.ea.Ua(a).Qa().map(function(a){return this.Bb(a)}.bind(this));
var c=a[a.length-1].view;c.$();return new e(c,a)},Zb:function(a){this.c.removeAll(a);(new c([],[],a)).I(this.K);this.e.Sa(function(a){return!this.c.ya(a)}.bind(this))},$b:function(a){var d=this.c.J();this.c.clear();this.c.G(a);(new c(a,[],d)).I(this.K);this.e.Xb(function(a){return this.c.bc(a)}.bind(this))},S:function(a){a=this.Q(a);try{return Promise.resolve(new E(a.values.peek().slice()))}finally{a.dispose()}},ra:function(a){this.c.qa(a);(new c([],a)).I(this.K);this.e.ra(a)},dispose:function(){this.Fb.q();
this.e.dispose();if(this.j.length){var a=this.j.length,c=this.j.reduce(function(a,b){return a+b.A},0);window.console.warn("Some views were not or are not yet disposed ("+a+" views, "+c+" references).")}}};d.prototype=h.a.extend({},g.prototype,{get size(){return this.size},addEntries:d.prototype.Gb,dispose:d.prototype.dispose,addOrUpdateEntries:d.prototype.Ib,openView:d.prototype.Q,removeEntries:d.prototype.Zb,replaceEntries:d.prototype.$b,streamValues:d.prototype.S,updateEntries:d.prototype.ra},d.prototype);
var r=a.pureComputed(function(){return!1});e.prototype={get za(){return r},get Ba(){return this.f},get Da(){return a.pureComputed(function(){return{}})},get P(){return this.b.P},get size(){return this.B},get values(){return this.b.values},dispose:function(){this.t.forEach(function(a){a.q()})}};e.prototype=h.a.extend({get dirty(){return this.za},get filteredSize(){return this.Ba},get metadata(){return this.Da},get observables(){return this.P},get size(){return this.size},get values(){return this.values},
dispose:e.prototype.dispose},e.prototype);return d}({});z=function(){function d(d,e,h){h=h||new g(d);var b={};l.call(this,h,function(a){if(!c(b,a))throw Error("No known entry with id `"+a+"`.");return b[a].value});this.fa=d;this.e=h;this.Oa=e;this.c=b;this.B=a.observable(0);this.Ab=a.pureComputed(function(){return this.B()}.bind(this));this.j=[]}function e(c,d,e){var b=a.observable(!1),g=a.observable(!1),l=a.observable({unfilteredSize:c.size.peek(),filteredSize:0}),p=h.aa(),q=a.observable(),u=a.pureComputed(function(){if(b.peek())return b();
g(!0);b(!0);var a=d.Ha().normalize();window.setTimeout(function(){if(!a.Z(d.Ha().normalize()))return b(!1);c.Oa.issue(a).then(function(a){var b=[];a.values.reduce(function(a,c){return b.push(c)});q(b);delete a.values;c.B(a.unfilteredSize);l(a)}).then(function(){g(!1);b(!1)},function(){b(!1)})})}),t=a.pureComputed(function(){u();var a=q(),a=h.aa(a);v?(v=a.map(function(a){c.Na(a);return c.e.s(a)}),p.forEach(function(a){c.Pa(a);c.e.q(a)})):(a.forEach(c.Na.bind(c)),p.forEach(c.Pa.bind(c)));return p=a});
this.c=t;var v=null;this.n=a.pureComputed(function(){t();v||(v=p.map(c.e.s));return v});this.n.subscribe(function(){return v=null},null,"asleep");this.f=a.pureComputed(function(){return g()});this.N=a.pureComputed(function(){return l()});this.b=a.pureComputed(function(){return l().filteredSize});this.B=a.pureComputed(function(){return t().size()});this.t=function(){u.dispose();e()}}var a=u,h=w,l=D,g=A,c=p.a.v;d.prototype={get size(){return this.Ab},Na:function(a){var d=this.fa(a);c(this.c,d)?(d=this.c[d],
++d.A,d.value=a):this.c[d]={A:1,value:a}},Pa:function(a){a=this.fa(a);if(!c(this.c,a))throw Error("Assertion error: Value with id `"+a+"` was expected to be referenced.");0===--this.c[a].A&&delete this.c[a]},Q:function(a){a=(a||function(a){return a})(new B);var c=l.ea.Ua(a),d=p.o.na(this.j,function(a){return c.Z(a.key)});if(d)return d.s().view;a=new e(this,a,function(){return b.q()});var b=new l.Ka(c,a,function(){return this.j.splice(this.j.indexOf(b),1)}.bind(this));this.j.push(b);return a},S:function(a){a=
(a||function(a){return a})(new B);return this.Oa.issue(a.Ha().normalize())},dispose:function(){this.e.dispose();if(this.j.length){var a=this.j.length,c=this.j.reduce(function(a,b){return a+b.A},0);window.console.warn("Some views were not or are not yet disposed ("+a+" views, "+c+" references).")}}};d.prototype=p.a.extend({},l.prototype,{get size(){return this.size},dispose:d.prototype.dispose,openView:d.prototype.Q,streamValues:d.prototype.S},d.prototype);e.prototype={get za(){return this.f},get Ba(){return this.b},
get Da(){return this.N},get P(){return this.n},get size(){return this.B},get values(){return this.c},dispose:function(){this.t()}};e.prototype=p.a.extend({},{get dirty(){return this.za},get filteredSize(){return this.Ba},get metadata(){return this.Da},get observables(){return this.P},get size(){return this.size},get values(){return this.values},dispose:e.prototype.dispose},e.prototype);return d}({});return function(d){return d}(function(d,e,a,h,l){return{ClientSideDataSource:d,DefaultObservableStateTransitioner:e,
ObservableEntries:a,ServerSideDataSource:h,streams:l}}(q,t,A,z,function(d,e){return{streamArray:function(a){return new e(d.aa(a))}}}(w,E)))}"function"===typeof define&&define.amd?define(["knockout"],F):window["ko-data-source"]=F(window.ko);