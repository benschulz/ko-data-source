/*
 Copyright (c) 2015, Ben Schulz
 License: BSD 3-clause (http://opensource.org/licenses/BSD-3-Clause)
*/
function x(r){var p,q,w,u,t,v,y,z,A,B,C;p=function(){var e;e=function(){function c(a,b){return Object.prototype.hasOwnProperty.call(a,b)}return{a:function(a,b){if(a===b)return!0;var f=!!b&&"function"===typeof b.valueOf;return!!a&&"function"===typeof a.valueOf&&f&&a.valueOf()===b.valueOf()},extend:function(a,b){Array.prototype.slice.call(arguments,1).forEach(function(b){for(var c=Object.keys(b),n=0,l=c.length;n<l;n++){var m=c[n],d=Object.getOwnPropertyDescriptor(b,m);void 0!==d&&d.enumerable&&Object.defineProperty(a,
m,d)}});return a},j:function(a,b){for(var f in a)c(a,f)&&b(f,a[f])},W:c,k:function(a,b){var f={},k;for(k in a)c(a,k)&&(f[k]=b(a[k],k,a));return f}}}();return function(c){return c}(function(c,a,b,f){return{V:c,Aa:a,d:b,Ya:f}}(function(c){function a(a){return a.filter(function(a,n,d){return d.lastIndexOf(a)===n})}function b(a,l){for(var b=a.length,d=-1,h=0;h<b;++h)if(l(a[h])){if(0<=d)throw Error("Multiple elements match the predicate.");d=h}return d}function f(a,l){return a&&"function"===typeof a.valueOf&&
l&&"function"===typeof l.valueOf?a.valueOf()<=l.valueOf()?a.valueOf()<l.valueOf()?-1:0:1:a<=l?a<l?-1:0:1}function k(a,l){var b=a.length,d=Array(b),h=Array(b),g;for(g=0;g<b;++g)d[g]=g,h[g]=a[g];g=a;a=h;h=g;d.sort(function(h,g){return l(a[h],a[g])||h-g});for(g=0;g<b;++g)h[g]=a[d[g]];return h}return{contains:function(a,b){return 0<=a.indexOf(b)},b:function(b){if(50<b.length){for(var l=b.length,m={},d,h=0;h<l;++h)if(d=b[h],"string"===typeof d)if(c.W(m,d))break;else m[d]=!0;else if(b.lastIndexOf(d)!==
h)break;if(!(h>=l)){for(var g=b.slice(0,h);h<l;++h)d=b[h],"string"===typeof d?c.W(m,d)||(m[d]=!0,g.push(d)):b.lastIndexOf(d)===h&&g.push(d);b=g}}else b=a(b);return b},g:function(a,b){return Array.prototype.concat.apply([],a.map(b))},Oa:function(a,l){var c=b(a,l);if(0>c)throw Error("None of the elements matches the predicate.");return a[c]},Pa:function(a,l){var c=b(a,l);return 0<=c?a[c]:null},ma:function(a,b){var c=b||f;window.chrome?c=k(a,c):(a.sort(c),c=a);return c}}}(e),function(){function c(a){return function(){return a}}
return{Za:c(!0),Va:c(!1),Wa:c(void 0),Xa:c(null),$a:c(0),Ua:c,Ca:function(a){return a}}}(),e,{a:function(c){return c.replace(/([A-Z])/g,function(a){return"-"+a.toLowerCase()})},b:function(c){return c.replace(/-([a-z])/g,function(a){return a[1].toUpperCase()})},format:function(c){var a=arguments;return c.replace(/{(\d+)}/g,function(b,c){var k=parseInt(c,10)+1;return typeof a.length<=k?b:a[k]})}}))}();q=function(e){return function(c){return c}(function(c){function a(a){var e={get length(){return this.length},
contains:function(a){return 0<=this.na(a)},filter:function(a){for(var c=this.length,d=[],h=0;h<c;++h){var g=this.get(h);a(g,h,this)&&d.push(g)}return new b(d)},forEach:function(a){for(var b=this.length,d=0;d<b;++d)a(this.get(d),d,this)},get:function(a){return this.get(a)},map:function(a){for(var c=this.length,d=Array(c),h=0;h<c;++h)d[h]=a(this.get(h),h,this);return new b(d)},readOnly:function(){return new f(this)},reduce:function(a,b){var d=1<arguments.length,h=this.length;if(!d&&0===h)throw new TypeError("An empty list can not be reduced, specify an initial value.");
for(var g=d?b:this.get(0),d=d?0:1;d<h;++d)g=a(g,this.get(d));return g},slice:function(a,c){var d=this.length;a=0>=arguments.length?0:0<=a?a:d+a;c=1>=arguments.length?d:0<=c?c:d+c;for(var d=c-a,h=Array(d),g=0;g<d;++g)h[g]=this.get(a+g);return new b(h)},A:function(){for(var a=this.length,b=Array(a),d=0;d<a;++d)b[d]=this.get(d);return b},na:function(a){for(var b=this.length,d=0;d<b;++d)if(this.get(d)===a)return d;return-1}};return c.d.extend(e,{get length(){return this.length},contains:e.contains,filter:e.filter,
forEach:e.forEach,get:function(a){return this.get(a)},map:e.map,readOnly:e.readOnly,reduce:e.reduce,slice:e.slice,toArray:e.A,tryFirstIndexOf:e.na},a)}function b(a){this.$=a}function f(a){this.D=a}b.prototype=a({get length(){return this.$.length},get:function(a){return this.$[a]},A:function(){return this.$.slice()}});f.prototype=a({get length(){return this.D.length},get:function(a){return this.D.get(a)}});return{Ka:function(a){return new b(a||[])},Ia:a}}(e))}(p);w=function(e,c){return function(a){return a}(function(a,
b){function c(a){if("string"!==typeof a)throw Error("Ids must be strings. (given: `"+a+"`, type: `"+typeof a+"`)");return a}function e(h,g){return a.d.W(h,c(g))?h[g]:-1}function n(a,g){var d=e(a,g);if(0>d)throw Error("Es existiert kein Eintrag mit Id '"+g+"'.");return d}function l(a,g,d,b,c){if(b>=c)return b;var e=Math.floor((b+c)/2);return 0>g(d,a[e])?l(a,g,d,b,e):l(a,g,d,e+1,c)}function m(a,g,d,b,c){function e(b,c){var l=f.length,D=g.slice(b,c);f=f.concat(D);D.forEach(function(g){d[a(g)]=l;++l})}
var f=[],l=0;b.forEach(function(a){e(l,a);l=a;c(f)});e(l,g.length);return f}function d(a){this.l=function(g){return c(a(g))};this.f=[];this.h={};this.o=null}d.prototype=b.Ia({get length(){return this.f.length},get:function(a){return this.f[a]},Ba:function(a){a=n(this.h,a);return this.f[a]},clear:function(){this.f=[];this.h={}},contains:function(a){a=(0,this.l)(a);return 0<=e(this.h,a)},xa:function(a){return 0<=e(this.h,a)},removeAll:function(a){this.Na(a.map(this.l))},Na:function(a){if(a.length){var g=
this.l,d=this.f,b=this.h;a=a.map(function(a){return n(b,a)+1});a.sort(function(a,d){return a-d});this.f=m(g,d,b,a,function(a){a=a.pop();a=g(a);delete b[a]})}},Qa:function(d){var g=this.l,b=this.f,c=this.h;this.o=d;a.V.ma(b,d);d=!1;for(var e=0;e<b.length;++e){var f=g(b[e]);d=d||c[f]!==e;c[f]=e}return d},oa:function(a){if(this.o)throw Error("`updateAll` must not be called on a sorted `IndexedTable`. Use a combination of order-preserving `tryUpdateAll`, `removeAll` and `insertAll` instead.");if(a.length){var d=
this.l,b=this.f,c=this.h;a.forEach(function(a){var h=n(c,d(a));b[h]=a})}},Ra:function(a){if(!this.o)throw Error("`tryUpdateAll` is designed for sorted `IndexedTable`s. For unsorted ones, use `updateAll` instead.");if(!a.length)return[];var d=this.l,b=this.f,c=this.h,e=this.o,f=[];a.forEach(function(a){var h=n(c,d(a));0!==e(a,b[h])?f.push(a):b[h]=a});return f},G:function(d){if(this.o)throw Error("`addAll` must not be called on an sorted `IndexedTable`. Use order-preserving `insertAll` instead.");if(d.length){var b=
this.l,c=this.f,e=this.h;d.forEach(function(d){var h=b(d);if(a.d.W(e,h))throw Error("The list already contains an element with id `"+h+"`. Did you mean to call `updateAll`?.");e[h]=c.push(d)-1})}},Da:function(d){if(!this.o)throw Error("`insertAll` is designed for sorted `IndexedTable`s. For unsorted ones, use `addAll` instead.");if(d.length){var b=this.l,c=this.f,e=this.h,f=this.o;a.V.ma(d,f);var k=0,n=[];d.forEach(function(a){a=l(c,f,a,k,c.length);n.push(a);k=a});k=0;this.f=m(b,c,e,n,function(a){var c=
d[k],f=b(c),l=a.length;a.push(c);e[f]=l;++k})}}});return d}(c,e))}(q,p);u=function(){function e(c,a,b){this.H=c||[];this.Q=a||[];this.O=b||[]}e.prototype={get size(){return this.H.length+this.Q.length+this.O.length},get empty(){return!this.size},r:function(c){this.empty||c(this)}};return e}();t={};v=function(e,c,a,b,f){function k(c,f,k){this.S=c;this.c=f||new a(c.F);this.p=k||e.observable(new b);this.ga=e.observable(this.c.readOnly());this.u=null}k.prototype={get F(){return this.S.F},get i(){return this.S.i},
get values(){return this.ga},get X(){this.u||(this.u=e.observable(this.c.map(this.i.v)));return this.u},U:function(a){this.ga.valueHasMutated();this.u&&(a.H.forEach(this.i.v),this.u(this.c.map(this.i.Ja)),a.O.forEach(this.i.n))},ca:function(){this.u&&this.c.forEach(this.i.n)},K:function(){this.S.K();this.R()},J:function(a){return new f.ra(this,a)},P:function(a){return new f.ta(this,a)},ia:function(a,b){return new f.qa(this,a,b)}};return k}(r,p,w,u,t);y=function(e,c,a){function b(b,c,e,l){a.call(this,
{F:b,i:c},e,l);this.C=l.subscribe(function(a){this.U(a)}.bind(this))}b.prototype=c.d.extend({},a.prototype,{K:function(){},dispose:function(){this.C.dispose();this.ca()}});return b}(r,p,v);(function(e,c,a,b,f){function k(c,f){b.call(this,c);var k=e.observable(e.unwrap(f));this.R=function(){return k(e.unwrap(f))};this.B=e.computed(function(){k();var d=e.unwrap(f);k(d);var b=this.c.A(),d=this.S.c.filter(d).A(),b=new a(d,[],b);this.c.clear();this.c.G(d);this.U(b);b.r(this.p)}.bind(this));this.C=c.p.subscribe(function(d){var b;
b=this.F;for(var c=this.c,k=e.unwrap(f),m=d.H.filter(k),n=[],p=d.O.filter(k),q=0,r=d.Q.length;q<r;q++){var t=d.Q[q],u=c.xa(b(t));k(t)?u?n.push(t):m.push(t):u&&p.push(t)}b=new a(m,n,p);b.empty||(this.c.removeAll(b.O),this.c.oa(b.Q),this.c.G(b.H),this.U(d),b.r(this.p))}.bind(this))}k.prototype=c.d.extend({},b.prototype,{dispose:function(){this.B.dispose();this.C.dispose();this.ca()}});return f.ra=k})(r,p,u,v,t);(function(e,c,a,b){function f(b,c){a.call(this,b);this.c.G(b.c.A());var f=e.observable(e.unwrap(c));
this.R=function(){return f(e.unwrap(c))};this.B=e.computed(function(){f();var a=e.unwrap(c);f(a);this.c.Qa(a)&&this.p.valueHasMutated()}.bind(this));this.C=b.p.subscribe(function(a){var b=this.c.Ra(a.Q);this.c.removeAll(a.O.concat(b));this.c.Da(a.H.concat(b));this.U(a);this.p.valueHasMutated()}.bind(this))}f.prototype=c.d.extend({},a.prototype,{J:function(){throw Error("Filtering a sorted view is not supported.");},P:function(){throw Error("Sorting a sorted view is not supported.");},dispose:function(){this.B.dispose();
this.C.dispose();this.ca()}});return b.ta=f})(r,p,v,t);(function(e,c,a,b){function f(b,c,f){function m(){return{offset:e.unwrap(c),m:e.unwrap(f)}}var d=b.i;this.aa=b;this.e=e.observable(a.Ka());this.t=null;var h=b.F,g=e.observable(m());this.R=function(){var a=g(),b=m();a.offset===b.offset&&a.m===b.m||g(b)};this.B=e.computed(function(){b.p();g();var a=m();g(a);var c=b.c,f=Math.min(c.length,a.offset),e=Math.min(c.length,f+a.m),a=this.e.peek(),c=c.slice(f,e);a:if(a.length!==c.length)f=!0;else{for(f=
a.length-1;0<=f;--f)if(h(a.get(f))!==h(c.get(f))){f=!0;break a}f=!1}f&&(this.e(c),this.t&&(this.t(this.e.peek().map(d.v)),a.forEach(d.n)))}.bind(this))}f.prototype=c.Aa.Ca({get values(){return this.e},get X(){this.t||(this.t=e.observable(this.values().map(this.aa.i.v)));return this.t},K:function(){this.aa.K();this.R()},J:function(){throw Error("Filtering a clipped view is not supported.");},P:function(){throw Error("Sorting a clipped view is not supported.");},ia:function(){throw Error("Clipping a clipped view is not supported.");
},dispose:function(){this.B.dispose();this.t&&this.e().forEach(this.aa.i.n)}});return b.qa=f})(r,p,q,t);z={sa:y};q=function(e){function c(a,c,e){this.b=a;this.a=e?function(a,b){var m=c(b);try{return a(m)}finally{e(m)}}:function(a,b){return a(c(b))}}c.prototype={forEach:function(a){this.b.forEach(this.a.bind(null,a))},map:function(a){return new c(this,a)},reduce:function(a,c){return this.b.reduce(function(c,f){return a(c,this.a(function(a){return a},f))}.bind(this),c)}};var a=c.prototype;e.d.extend(a,
{forEach:a.forEach,map:a.map,reduce:a.reduce});return c}(p);A=function(e,c,a){function b(a,b){this.g=b;this.a=a}function f(a){this.b=a;this.a=null}function k(a,b,c){this.q=a;this.da=b;this.ea=c;this.w=!1;this.b=this.a=this.j=this.k=null}b.prototype={q:function(a){return new f(this.b(a))},b:function(a){return new k(this.a,this.g,a)},w:function(b){return this.k(b).then(function(b){return new a(b,this.a.v.bind(this.a),this.a.n.bind(this.a))}.bind(this))},j:function(){throw Error("`"+this.constructor+
"` does not implement `openView`.");},k:function(){throw Error("`"+this.constructor+"` does not implement `streamValues`.");},dispose:function(){throw Error("`"+this.constructor+"` does not implement `dispose`.");}};var n=b.prototype;c.d.extend(n,{openEntryView:n.q,openOptionalEntryView:n.b,streamObservables:n.w});f.prototype={get Z(){return this.b.Z},get observable(){this.a||(this.a=this.b.L.subscribe(function(){throw Error("Illegal state: A non-optional view for this entry is still open.");}));
return this.b.observable},dispose:function(){this.a&&this.a.dispose();this.b.dispose()}};k.prototype={g:function(){if(this.w)throw Error("Illegal state: Entry view was already disposed.");},get Z(){this.g();return this.k=this.da(this.ea)},get observable(){this.g();return(this.j||this.L)&&this.j},get L(){this.g();if(this.a)return this.a;var a=this.q.va(this.Z());this.j=a();this.a=e.observable({Ma:!0,observable:this.observable()});this.b=a.subscribe(function(){this.a({Ma:!1,observable:this.observable()})}.bind(this));
return this.a},dispose:function(){this.g();this.w=!0;this.b&&(this.b.dispose(),this.q.n(this.k),this.k=this.j=this.a=this.b=null)}};return b}(r,p,q);B=function(e,c){function a(a){this.D=a}a.prototype={forEach:function(a){this.D.forEach(a)},map:function(a){return new c(this,a)},reduce:function(a,b){return Promise.resolve(this.D.reduce(a,b))}};var b=a.prototype;e.d.extend(b,{forEach:b.forEach,map:b.map,reduce:b.reduce});return a}(p,q);q=function(e,c){function a(a,b,e){c.call(this,a,b,e)}var b={Ha:function(a){return new c(this.T,
this.ba,this.fa,a)}};a.prototype=e.d.extend({},c.prototype,b,{limitedTo:b.Ha});return a}(p,function(){return function(e,c,a,b){this.T=e;this.ba=c;this.fa=a;this.ua=b}}());q=function(e,c){function a(a,b){c.call(this,a,b)}var b={La:function(a){return new c(this.T,this.ba,a)}};a.prototype=e.d.extend({},c.prototype,b,{offsetBy:b.La});return a}(p,q);q=function(e,c){function a(a){c.call(this,a)}var b={P:function(a){return new c(this.T,a)}};a.prototype=e.d.extend({},c.prototype,b,{sortedBy:b.P});return a}(p,
q);q=function(e,c){function a(){c.call(this)}var b={J:function(a){return new c(a)}};a.prototype=e.d.extend({},c.prototype,b,{filteredBy:b.J});return a}(p,q);C=function(e,c){function a(){c.call(this)}a.prototype=e.d.extend({},c.prototype);return a}(p,q);return function(e){return e}(function(e,c,a){return{ClientSideDataSource:e,DefaultObservableStateTransitioner:c,ObservableEntries:a}}(function(){function e(){return 0}function c(){return!0}function a(a,c){var e=new h(a);m.call(this,c,function(a){return e.Ba(a)});
this.w=a;this.g=c;this.e=e;this.a=n.observable(new d);this.b=[];this.q(new b,new l.sa(this.w,this.g,this.e,this.a))}function b(a,b,d,f){this.M=a||c;this.I=b||e;this.offset=d||0;this.m=f||0===f?f:Number.POSITIVE_INFINITY;this.s=Math.max(this.M===c?0:1,this.I===e?0:2,0===this.offset&&this.m===Number.POSITIVE_INFINITY?0:3)}function f(a,b,c){this.key=a;this.view=b;this.N=1;this.a=c}function k(a,b){this.a=a;this.b=b}var n=r,l=z,m=A,d=u,h=w;a.prototype={q:function(a,b){var c=new f(a,b,function(){return this.b.splice(this.b.indexOf(c),
1)}.bind(this));this.b.push(c);return c},da:function(a){var b=p.V.Pa(this.b,function(b){return a.ja(b.key)});if(b)return++b.N,b;var c=a.ka(),b=p.V.Oa(this.b,function(a){return c.ja(a.key)}).view,b=a.wa(b);return this.q(a,b)},ea:function(a){this.e.G(a);(new d(a)).r(this.a)},Ea:function(a){var b=[],c=[];a.forEach(function(a){return(this.e.contains(a)?c:b).push()}.bind(this));(new d(b,c)).r(this.a)},j:function(a){a=(a||function(a){return a})(new C);a=b.a(a).ha().map(function(a){return this.da(a)}.bind(this));
var c=a[a.length-1].view;c.K();return new k(c,a)},Fa:function(a){this.e.removeAll(a);(new d([],[],a)).r(this.a)},Ga:function(a){var b=this.e.A();this.e.clear();this.e.G(a);(new d(a,[],b)).r(this.a);this.g.Y(a)},k:function(a){a=this.j(a);try{var b=a.values;return Promise.resolve(new B(b().slice()))}finally{a.dispose()}},Y:function(a){this.e.oa(a);(new d([],a)).r(this.a);this.g.Y(a)}};a.prototype=p.d.extend({},m.prototype,a.prototype,{addEntries:a.prototype.ea,dispose:a.prototype.dispose,addOrUpdateEntries:a.prototype.Ea,
openView:a.prototype.j,removeEntries:a.prototype.Fa,replaceEntries:a.prototype.Ga,streamValues:a.prototype.k,updateEntries:a.prototype.Y});b.a=function(a){return new b(a.T,a.ba,a.fa,a.ua)};b.prototype={ja:function(a){return this.s===a.s&&this.M===a.M&&this.I===a.I&&this.offset===a.offset&&this.m===a.m},ka:function(){if(0>=this.s)throw Error("Unsupported operation.");var a=[null,this.M,this.I].slice(0,this.s);return new (b.bind.apply(b,a))},ha:function(){return 0===this.s?[this]:this.ka().ha().concat([this])},
wa:function(a){var b=[[this.M],[this.I],[this.offset,this.m]][this.s-1];return(0,[function(a){return a.J},function(a){return a.P},function(a){return a.ia}][this.s-1])(a).apply(a,b)}};f.prototype={v:function(){if(0>=this.N)throw Error("Assertion error: Reference count at `"+this.N+"`.");++this.N},n:function(){0===--this.N&&this.a()}};k.prototype={get values(){return this.a.values},get X(){return this.a.X},dispose:function(){this.b.forEach(function(a){a.n()})}};k.prototype=p.d.extend({get values(){return this.values},
get observables(){return this.X},dispose:k.prototype.dispose},k.prototype);return a}({}),function(e){return function(){var c={};Array.prototype.slice.call(arguments).forEach(function(a){c[a]=!0});this.constructor=function(a){var b={};Object.keys(a).forEach(function(f){b[f]=c[f]?a[f]:e.observable(a[f])});return b};this.pa=function(a,b){Object.keys(b).filter(function(a){return!c[a]}).forEach(function(c){a[c](b[c])});return a};this.ya=function(){}}}(r),function(e){function c(a){this.observable=a;this.L=
e.observable(a);this.la=1}return function(a,b){function f(a){var b=k(a);if(!b)throw Error("Es existierte keine Referenz zum Objekt mit Id '"+a+"' oder es wurden bereits alle freigegeben.");return b}function k(a){if("string"!==typeof a)throw l(a);return Object.prototype.hasOwnProperty.call(m,a)?m[a]:null}function n(d){var e=a(d);if("string"!==typeof e)throw l(e);Object.prototype.hasOwnProperty.call(m,e)?(e=m[e],++e.la):(d=new c(b.constructor(d)),e=m[e]=d);return e}function l(a){throw Error("Illegal argument: Ids must be strings ('"+
a+"' is of type '"+typeof a+"').");}b=b||{constructor:function(a){var b={};Object.keys(a).forEach(function(c){b[c]=e.observable(a[c])});return b},pa:function(a,b){Object.keys(b).forEach(function(c){a[c](b[c])});return a},ya:function(){}};var m={};this.v=function(a){return n(a).observable};this.va=function(a){return n(a).L};this.n=function(b){b=a(b);0===--f(b).la&&delete m[b]};this.za=function(a){f(a).L(null);delete m[a]};this.Ja=function(b){return f(a(b)).observable};this.Ta=function(a,b){var c=k(a);
c&&b(c.observable)};this.Sa=function(b,c){return this.Ta(a(b),c)}.bind(this);this.Y=function(a){a.forEach(function(a){this.Sa(a,function(c){b.pa(c,a)})}.bind(this))}.bind(this);this.dispose=function(){Object.keys(m).forEach(this.za)}.bind(this)}}(r)))}"function"===typeof define&&define.amd?define(["knockout"],x):window["ko-data-source"]=x(window.ko);
