/*
 Copyright (c) 2015, Ben Schulz
 License: BSD 3-clause (http://opensource.org/licenses/BSD-3-Clause)
*/
var n;
function C(r){var p,v,z,w,q,u,x,D,A,B,y,E;p=function(){var c;c=function(){function e(a,f){return Object.prototype.hasOwnProperty.call(a,f)}return{sb:function(a,f){if(a===f)return!0;var e=!!f&&"function"===typeof f.valueOf;return!!a&&"function"===typeof a.valueOf&&e&&a.valueOf()===f.valueOf()},extend:function(a,f){Array.prototype.slice.call(arguments,1).forEach(function(f){for(var e=Object.keys(f),d=0,t=e.length;d<t;d++){var g=e[d],b=Object.getOwnPropertyDescriptor(f,g);void 0!==b&&b.enumerable&&Object.defineProperty(a,
g,b)}});return a},yb:function(a,f){for(var c in a)e(a,c)&&f(c,a[c])},J:e,Eb:function(a,f){var c={},l;for(l in a)e(a,l)&&(c[l]=f(a[l],l,a));return c}}}();return function(e){return e}(function(e,a,f,c){return{m:e,pa:a,d:f,fa:c}}(function(e){function a(d){return d.filter(function(d,a,b){return b.lastIndexOf(d)===a})}function f(d,a){for(var g=d.length,b=-1,h=0;h<g;++h)if(a(d[h])){if(0<=b)throw Error("Multiple elements match the predicate.");b=h}return b}function c(d,a){return d&&"function"===typeof d.valueOf&&
a&&"function"===typeof a.valueOf?d.valueOf()<=a.valueOf()?d.valueOf()<a.valueOf()?-1:0:1:d<=a?d<a?-1:0:1}function l(d,a){var g=d.length,b=Array(g),h=Array(g),m;for(m=0;m<g;++m)b[m]=m,h[m]=d[m];m=d;d=h;h=m;b.sort(function(b,h){return a(d[b],d[h])||b-h});for(m=0;m<g;++m)h[m]=d[b[m]];return h}return{contains:function(d,a){return 0<=d.indexOf(a)},wb:function(d){if(50<d.length){for(var f=d.length,g={},b,h=0;h<f;++h)if(b=d[h],"string"===typeof b)if(e.J(g,b))break;else g[b]=!0;else if(d.lastIndexOf(b)!==
h)break;if(!(h>=f)){for(var m=d.slice(0,h);h<f;++h)b=d[h],"string"===typeof b?e.J(g,b)||(g[b]=!0,m.push(b)):d.lastIndexOf(b)===h&&m.push(b);d=m}}else d=a(d);return d},xb:function(d,a){return Array.prototype.concat.apply([],d.map(a))},Sa:function(d,a){var g=f(d,a);if(0>g)throw Error("None of the elements matches the predicate.");return d[g]},da:function(d,a){var g=f(d,a);return 0<=g?d[g]:null},sa:function(d,a){var g=a||c;window.chrome?g=l(d,g):(d.sort(g),g=d);return g}}}(c),function(){function c(a){return function(){return a}}
return{Qb:c(!0),Nb:c(!1),Ob:c(void 0),Pb:c(null),Rb:c(0),tb:c,Cb:function(a){return a}}}(),c,{ub:function(c){return c.replace(/([A-Z])/g,function(a){return"-"+a.toLowerCase()})},vb:function(c){return c.replace(/-([a-z])/g,function(a){return a[1].toUpperCase()})},format:function(c){var a=arguments;return c.replace(/{(\d+)}/g,function(c,e){var l=parseInt(e,10)+1;return typeof a.length<=l?c:a[l]})}}))}();v=function(c){return function(c){return c}(function(c){function a(a){var d={get length(){return this.length},
contains:function(a){return 0<=this.ta(a)},filter:function(a){for(var d=this.length,b=[],h=0;h<d;++h){var m=this.get(h);a(m,h,this)&&b.push(m)}return new f(b)},forEach:function(a){for(var d=this.length,b=0;b<d;++b)a(this.get(b),b,this)},get:function(a){return this.get(a)},map:function(a){for(var d=this.length,b=Array(d),h=0;h<d;++h)b[h]=a(this.get(h),h,this);return new f(b)},readOnly:function(){return new k(this)},reduce:function(a,d){var b=1<arguments.length,h=this.length;if(!b&&0===h)throw new TypeError("An empty list can not be reduced, specify an initial value.");
for(var m=b?d:this.get(0),b=b?0:1;b<h;++b)m=a(m,this.get(b));return m},slice:function(a,d){var b=this.length;a=0>=arguments.length?0:0<=a?a:b+a;d=1>=arguments.length?b:0<=d?d:b+d;for(var b=d-a,h=Array(b),m=0;m<b;++m)h[m]=this.get(a+m);return new f(h)},D:function(){for(var a=this.length,d=Array(a),b=0;b<a;++b)d[b]=this.get(b);return d},ta:function(a){for(var d=this.length,b=0;b<d;++b)if(this.get(b)===a)return b;return-1}};return c.d.extend(d,{get length(){return this.length},contains:d.contains,filter:d.filter,
forEach:d.forEach,get:function(a){return this.get(a)},map:d.map,readOnly:d.readOnly,reduce:d.reduce,slice:d.slice,toArray:d.D,tryFirstIndexOf:d.ta},a)}function f(a){this.ja=a}function k(a){this.Q=a}f.prototype=a({get length(){return this.ja.length},get:function(a){return this.ja[a]},D:function(){return this.ja.slice()}});k.prototype=a({get length(){return this.Q.length},get:function(a){return this.Q.get(a)}});return{V:function(a){return new f(a||[])},Ma:a}}(c))}(p);z=function(c,e){return function(a){return a}(function(a,
c){function e(b){if("string"!==typeof b)throw Error("Ids must be strings. (given: `"+b+"`, type: `"+typeof b+"`)");return b}function l(b,d){return a.d.J(b,e(d))?b[d]:-1}function d(b,a){var d=l(b,a);if(0>d)throw Error("No entry with Id `"+a+"`.");return d}function t(b,a,d,c,f){if(c>=f)return c;var g=Math.floor((c+f)/2);return 0>a(d,b[g])?t(b,a,d,c,g):t(b,a,d,g+1,f)}function g(b,a,d,c,f){function g(c,f){var k=e.length,l=a.slice(c,f);e=e.concat(l);l.forEach(function(a){d[b(a)]=k;++k})}var e=[],k=0;c.forEach(function(b){g(k,
b);k=b;f(e)});g(k,a.length);return e}function b(b){this.w=function(a){return e(b(a))};this.o=[];this.q={};this.u=null}b.prototype=c.Ma({get length(){return this.o.length},get:function(b){return this.o[b]},Ia:function(b){b=d(this.q,b);return this.o[b]},clear:function(){this.o=[];this.q={}},contains:function(b){b=(0,this.w)(b);return 0<=l(this.q,b)},Ea:function(b){return 0<=l(this.q,b)},removeAll:function(b){this.Ra(b.map(this.w))},Ra:function(b){if(b.length){var a=this.w,c=this.o,f=this.q;b=b.map(function(b){return d(f,
b)+1});b.sort(function(b,a){return b-a});this.o=g(a,c,f,b,function(b){b=b.pop();b=a(b);delete f[b]})}},Ta:function(b){var d=this.w,c=this.o,f=this.q;this.u=b;a.m.sa(c,b);b=!1;for(var g=0;g<c.length;++g){var e=d(c[g]);b=b||f[e]!==g;f[e]=g}return b},va:function(b){if(this.u)throw Error("`updateAll` must not be called on a sorted `IndexedTable`. Use a combination of order-preserving `tryUpdateAll`, `removeAll` and `insertAll` instead.");if(b.length){var a=this.w,c=this.o,f=this.q;b.forEach(function(b){var h=
d(f,a(b));c[h]=b})}},Va:function(b){if(!this.u)throw Error("`tryUpdateAll` is designed for sorted `IndexedTable`s. For unsorted ones, use `updateAll` instead.");if(!b.length)return[];var a=this.w,c=this.o,f=this.q,g=this.u,e=[];b.forEach(function(b){var h=d(f,a(b));0!==g(b,c[h])?e.push(b):c[h]=b});return e},G:function(b){if(this.u)throw Error("`addAll` must not be called on an sorted `IndexedTable`. Use order-preserving `insertAll` instead.");if(b.length){var d=this.w,c=this.o,f=this.q;b.forEach(function(b){var h=
d(b);if(a.d.J(f,h))throw Error("The list already contains an element with id `"+h+"`. Did you mean to call `updateAll`?.");f[h]=c.push(b)-1})}},Ka:function(b){if(!this.u)throw Error("`insertAll` is designed for sorted `IndexedTable`s. For unsorted ones, use `addAll` instead.");if(b.length){var d=this.w,c=this.o,f=this.q,e=this.u;a.m.sa(b,e);var k=0,l=[];b.forEach(function(b){b=t(c,e,b,k,c.length);l.push(b);k=b});k=0;this.o=g(d,c,f,l,function(a){var c=b[k],g=d(c),e=a.length;a.push(c);f[g]=e;++k})}}});
return b}(e,c))}(v,p);w=function(){function c(c,a,f){this.S=c||[];this.Y=a||[];this.X=f||[]}c.prototype={get size(){return this.S.length+this.Y.length+this.X.length},get empty(){return!this.size},C:function(c){this.empty||c(this)}};return c}();q={};u=function(c,e,a,f,k){function l(d,e,g){this.aa=d;this.g=e||new a(d.R);this.B=g||c.observable(new f);this.ma=c.observable(this.g.readOnly());this.F=null;this.l=c.pureComputed(function(){this.ma();this.F||(this.F=this.g.map(this.r.s));return this.F}.bind(this));
this.l.subscribe(function(){return this.F=null}.bind(this),null,"asleep")}l.prototype={get R(){return this.aa.R},get r(){return this.aa.r},get values(){return this.ma},get K(){return this.l},ba:function(a){this.F&&(a.S.forEach(this.r.s),this.F=this.g.map(this.r.Db),a.X.forEach(this.r.p));this.ma.valueHasMutated()},la:function(){this.l&&this.g.forEach(this.r.p)},U:function(){this.aa.U();this.$()},I:function(a){return new k.$a(this,a)},M:function(a){return new k.ib(this,a)},Da:function(a,c){return new k.Wa(this,
a,c)}};return l}(r,p,z,w,q);x=function(c,e,a){function f(c,f,d,e){a.call(this,{R:c,r:f},d,e);this.P=e.subscribe(function(a){this.ba(a)}.bind(this))}f.prototype=e.d.extend({},a.prototype,{U:function(){},dispose:function(){this.P.dispose();this.la()}});return f}(r,p,u);(function(c,e,a,f,k){function l(d,e){f.call(this,d);var g=c.observable(c.unwrap(e));this.$=function(){return g(c.unwrap(e))};this.O=c.computed(function(){g();var b=c.unwrap(e);g(b);var d=this.g.D(),b=this.aa.g.filter(b).D(),d=new a(b,
[],d);this.g.clear();this.g.G(b);this.ba(d);d.C(this.B)}.bind(this));this.P=d.B.subscribe(function(b){var d;d=this.R;for(var f=this.g,g=c.unwrap(e),k=b.S.filter(g),l=[],p=b.X.filter(g),q=0,F=b.Y.length;q<F;q++){var r=b.Y[q],u=f.Ea(d(r));g(r)?u?l.push(r):k.push(r):u&&p.push(r)}d=new a(k,l,p);d.empty||(this.g.removeAll(d.X),this.g.va(d.Y),this.g.G(d.S),this.ba(b),d.C(this.B))}.bind(this))}l.prototype=e.d.extend({},f.prototype,{dispose:function(){this.O.dispose();this.P.dispose();this.la()}});return k.$a=
l})(r,p,w,u,q);(function(c,e,a,f){function k(f,d){a.call(this,f);this.g.G(f.g.D());var e=c.observable(c.unwrap(d));this.$=function(){return e(c.unwrap(d))};this.O=c.computed(function(){e();var a=c.unwrap(d);e(a);this.g.Ta(a)&&this.B.valueHasMutated()}.bind(this));this.P=f.B.subscribe(function(a){var b=this.g.Va(a.Y);this.g.removeAll(a.X.concat(b));this.g.Ka(a.S.concat(b));this.ba(a);this.B.valueHasMutated()}.bind(this))}k.prototype=e.d.extend({},a.prototype,{I:function(){throw Error("Filtering a sorted view is not supported.");
},M:function(){throw Error("Sorting a sorted view is not supported.");},dispose:function(){this.O.dispose();this.P.dispose();this.la()}});return f.ib=k})(r,p,u,q);(function(c,e,a,f){function k(f,d,e){function g(){return{offset:c.unwrap(d),i:c.unwrap(e)}}var b=f.r;this.ka=f;this.e=c.observable(a.V());this.l=null;var h=f.R,m=c.observable(g());this.$=function(){var b=m(),a=g();b.offset===a.offset&&b.i===a.i||m(a)};this.O=c.computed(function(){f.B();m();var a=g();m(a);var d=f.g,c=Math.min(d.length,a.offset),
e=Math.min(d.length,c+a.i),a=this.e.peek(),d=d.slice(c,e);a:if(a.length!==d.length)c=!0;else{for(c=a.length-1;0<=c;--c)if(h(a.get(c))!==h(d.get(c))){c=!0;break a}c=!1}c&&(this.e(d),this.l&&(this.l(this.e.peek().map(b.s)),a.forEach(b.p)))}.bind(this))}k.prototype={get values(){return this.e},get K(){this.l||(this.l=c.observable(this.values().map(this.ka.r.s)));return this.l},U:function(){this.ka.U();this.$()},I:function(){throw Error("Filtering a clipped view is not supported.");},M:function(){throw Error("Sorting a clipped view is not supported.");
},Da:function(){throw Error("Clipping a clipped view is not supported.");},dispose:function(){this.O.dispose();this.l&&this.e().forEach(this.ka.r.p)}};return f.Wa=k})(r,p,v,q);D={gb:x};q=function(c){function e(a,c,e){this.b=a;this.a=e?function(a,f){var g=c(f);try{return a(g)}finally{e(g)}}:function(a,f){return a(c(f))}}e.prototype={forEach:function(a){this.b.forEach(this.a.bind(null,a))},map:function(a){return new e(this,a)},reduce:function(a,c){return this.b.reduce(function(c,d){return a(c,this.a(function(a){return a},
d))}.bind(this),c)}};var a=e.prototype;c.d.extend(a,{forEach:a.forEach,map:a.map,reduce:a.reduce});return e}(p);A=function(c,e,a){function f(){return 0}function k(){return!0}function l(b,a){this.b=a;this.a=b}function d(b){this.b=b;this.a=null}function t(b,a,d){this.H=b;this.Ab=a;this.Bb=d;this.Ha=!1;this.b=this.a=this.n=this.t=null}function g(b,a,d,c){this.j=b||k;this.k=a||f;this.offset=d||0;this.i=c||0===c?c:Number.POSITIVE_INFINITY;this.A=Math.max(this.j===k?g.a:g.ya,this.k===f?g.a:g.h,0===this.offset&&
this.i===Number.POSITIVE_INFINITY?g.a:g.b)}function b(b,a,d){this.key=b;this.view=a;this.v=1;this.a=d}l.prototype={Oa:function(b){return new d(this.ra(b))},ra:function(b){return new t(this.a,this.b,b)},Ua:function(b){return this.N(b).then(function(b){return new a(b,this.a.s.bind(this.a),this.a.p.bind(this.a))}.bind(this))},L:function(){throw Error("`"+this.constructor+"` does not implement `openView`.");},N:function(){throw Error("`"+this.constructor+"` does not implement `streamValues`.");},dispose:function(){throw Error("`"+
this.constructor+"` does not implement `dispose`.");}};var h=l.prototype;e.d.extend(h,{openEntryView:h.Oa,openOptionalEntryView:h.ra,streamObservables:h.Ua});d.prototype={get value(){return this.b.value},get observable(){this.a||(this.a=this.b.W.subscribe(function(){throw Error("Illegal state: A non-optional view for this entry is still open.");}));return this.b.observable},dispose:function(){this.a&&this.a.dispose();this.b.dispose()}};t.prototype={h:function(){if(this.Ha)throw Error("Illegal state: Entry view was already disposed.");
},get value(){this.h();return this.t=this.Ab(this.Bb)},get observable(){this.h();return(this.n||this.W)&&this.n},get W(){this.h();if(this.a)return this.a;var b=this.H.pb(this.value());this.n=b();this.a=c.observable({Fb:!0,observable:this.observable()});this.b=b.subscribe(function(){this.a({Fb:!1,observable:this.observable()})}.bind(this));return this.a},dispose:function(){this.h();this.Ha=!0;this.b&&(this.b.dispose(),this.H.p(this.t),this.t=this.n=this.a=this.b=null)}};g.a=0;g.ya=1;g.h=2;g.b=3;g.Ga=
function(b){return new g(b.j,b.k,b.offset,b.i)};g.prototype={T:function(b){return this.A===b.A&&this.j===b.j&&this.k===b.k&&this.offset===b.offset&&this.i===b.i},Pa:function(){if(0>=this.A)throw Error("Unsupported operation.");var b=[null,this.j,this.k].slice(0,this.A);return new (g.bind.apply(g,b))},Ca:function(){return 0===this.A?[this]:this.Pa().Ca().concat([this])},rb:function(b){var a=[[this.j],[this.k],[this.offset,this.i]][this.A-1];return(0,[function(b){return b.I},function(b){return b.M},
function(b){return b.Da}][this.A-1])(b).apply(b,a)}};b.prototype={s:function(){if(0>=this.v)throw Error("Assertion error: Reference count at `"+this.v+"`.");++this.v;return this},p:function(){0===--this.v&&this.a();return this}};l.Z=g;l.xa=b;return l}(r,p,q);B=function(c,e){function a(a){this.Q=a}a.prototype={forEach:function(a){this.Q.forEach(a)},map:function(a){return new e(this,a)},reduce:function(a,c){return Promise.resolve(this.Q.reduce(a,c))}};var f=a.prototype;c.d.extend(f,{forEach:f.forEach,
map:f.map,reduce:f.reduce});return a}(p,q);q=function(c,e){function a(a,c,e,d){this.nb=a;this.u=c;this.mb=e;this.lb=d}a.prototype=e.d.extend({get predicate(){return this.j},get comparator(){return this.k},get offset(){return this.offset},get limit(){return this.i}},{get j(){return this.nb},get k(){return this.u},get offset(){return this.mb},get i(){return this.lb},normalize:function(){return new a(this.j||function(){return!0},this.k||function(){return 0},this.offset||0,this.i||0===this.i?this.i:Number.POSITIVE_INFINITY)},
ua:function(){return new a(c.unwrap(this.j),c.unwrap(this.k),c.unwrap(this.offset),c.unwrap(this.i))},T:function(a){return this.j===a.j&&this.k===a.k&&this.offset===a.offset&&this.i===a.i}});return a}(r,p);q=function(c,e){function a(a,c,d){e.call(this,a,c,d)}var f={La:function(a){return new e(this.j,this.k,this.offset,a)}};a.prototype=c.d.extend({},e.prototype,f,{limitedTo:f.La});return a}(p,q);q=function(c,e){function a(a,c){e.call(this,a,c)}var f={Na:function(a){return new e(this.j,this.k,a)}};
a.prototype=c.d.extend({},e.prototype,f,{offsetBy:f.Na});return a}(p,q);q=function(c,e){function a(a){e.call(this,a)}var f={M:function(a){return new e(this.j,a)}};a.prototype=c.d.extend({},e.prototype,f,{sortedBy:f.M});return a}(p,q);q=function(c,e){function a(){e.call(this)}var f={I:function(a){return new e(a)}};a.prototype=c.d.extend({},e.prototype,f,{filteredBy:f.I});return a}(p,q);y=function(c,e){function a(){e.call(this)}a.prototype=c.d.extend({},e.prototype);return a}(p,q);q=function(){function c(b,
c){var f=new t(b);l.call(this,c,function(b){return f.Ia(b)});this.n=b;this.h=c;this.e=f;this.b=a.observable(new d);this.a=[];var e=new k.gb(this.n,this.h,this.e,this.b);this.H=this.za(new l.Z,e);this.t=a.pureComputed(function(){return e.values().length})}function e(b,d){this.a=b;this.n=d;this.h=a.pureComputed(function(){return b.values().length});this.b=a.pureComputed(function(){return(f.m.da(d,function(b){return b.key.A===l.Z.ya})||d[0]).view.values().length})}var a=r,f=p,k=D,l=A,d=w,t=z;c.prototype=
{get size(){return this.t},za:function(b,a){var d=new l.xa(b,a,function(){return this.a.splice(this.a.indexOf(d),1)}.bind(this));this.a.push(d);return d},kb:function(b){var a=f.m.da(this.a,function(a){return b.T(a.key)});if(a)return a.s();var d=b.Pa(),a=f.m.Sa(this.a,function(b){return d.T(b.key)}).view,a=b.rb(a);return this.za(b,a)},ob:function(b){this.e.G(b);(new d(b)).C(this.b)},qb:function(b){var a=[],c=[];b.forEach(function(b){return(this.e.contains(b)?c:a).push()}.bind(this));(new d(a,c)).C(this.b)},
L:function(b){b=(b||function(b){return b})(new y);b=l.Z.Ga(b).Ca().map(function(b){return this.kb(b)}.bind(this));var a=b[b.length-1].view;a.U();return new e(a,b)},Gb:function(b){this.e.removeAll(b);(new d([],[],b)).C(this.b)},Hb:function(b){var a=this.e.D();this.e.clear();this.e.G(b);(new d(b,[],a)).C(this.b);this.h.ga(b)},N:function(b){b=this.L(b);try{return Promise.resolve(new B(b.values.peek().slice()))}finally{b.dispose()}},ga:function(b){this.e.va(b);(new d([],b)).C(this.b);this.h.ga(b)},dispose:function(){this.H.p();
if(this.a.length){var b=this.a.length,a=this.a.reduce(function(b,a){return b+a.v},0);window.console.warn("Some views were not or are not yet disposed ("+b+" views, "+a+" references).")}}};c.prototype=f.d.extend({},l.prototype,{get size(){return this.size},addEntries:c.prototype.ob,dispose:c.prototype.dispose,addOrUpdateEntries:c.prototype.qb,openView:c.prototype.L,removeEntries:c.prototype.Gb,replaceEntries:c.prototype.Hb,streamValues:c.prototype.N,updateEntries:c.prototype.ga},c.prototype);var g=
a.pureComputed(function(){return!1});e.prototype={get na(){return g},get oa(){return this.b},get qa(){return a.pureComputed(function(){return{}})},get K(){return this.a.K},get size(){return this.h},get values(){return this.a.values},dispose:function(){this.n.forEach(function(b){b.p()})}};e.prototype=f.d.extend({get dirty(){return this.na},get filteredSize(){return this.oa},get metadata(){return this.qa},get observables(){return this.K},get size(){return this.size},get values(){return this.values},
dispose:e.prototype.dispose},e.prototype);return c}({});u=function(c){return function(){var e={};Array.prototype.slice.call(arguments).forEach(function(a){e[a]=!0});this.constructor=function(a){var f={};Object.keys(a).forEach(function(k){f[k]=e[k]?a[k]:c.observable(a[k])});return f};this.wa=function(a,c){Object.keys(c).filter(function(a){return!e[a]}).forEach(function(e){a[e](c[e])});return a};this.Fa=function(){}}}(r);x=function(c){function e(a){this.observable=a;this.W=c.observable(a);this.Qa=1}
return function(a,f){function k(b){var a=l(b);if(!a)throw Error("Es existierte keine Referenz zum Objekt mit Id '"+b+"' oder es wurden bereits alle freigegeben.");return a}function l(b){if("string"!==typeof b)throw t(b);return Object.prototype.hasOwnProperty.call(g,b)?g[b]:null}function d(b){var d=a(b);if("string"!==typeof d)throw t(d);Object.prototype.hasOwnProperty.call(g,d)?(d=g[d],++d.Qa):(b=new e(f.constructor(b)),d=g[d]=b);return d}function t(b){throw Error("Illegal argument: Ids must be strings ('"+
b+"' is of type '"+typeof b+"').");}f=f||{constructor:function(b){var a={};Object.keys(b).forEach(function(d){a[d]=c.observable(b[d])});return a},wa:function(b,a){Object.keys(a).forEach(function(d){b[d](a[d])});return b},Fa:function(){}};var g={};this.s=function(b){return d(b).observable};this.pb=function(b){return d(b).W};this.p=function(b){b=a(b);0===--k(b).Qa&&delete g[b]};this.zb=function(b){k(b).W(null);delete g[b]};this.Db=function(b){return k(a(b)).observable};this.Jb=function(b,a){var d=l(b);
d&&a(d.observable)};this.Ib=function(b,d){return this.Jb(a(b),d)}.bind(this);this.ga=function(b){b.forEach(function(b){this.Ib(b,function(a){f.wa(a,b)})}.bind(this))}.bind(this);this.dispose=function(){Object.keys(g).forEach(this.zb)}.bind(this)}}(r);E=function(){function c(d,c,e){var b={};k.call(this,c,function(a){if(!l(b,a))throw Error("No known entry with id `"+a+"`.");return b[a].value});this.h=d;this.b=c;this.t=e;this.e=b;this.n=a.observable(0);this.H=a.pureComputed(function(){return this.n()}.bind(this));
this.a=[]}function e(d,c,e){var b=a.observable(!1),h=a.observable({unfilteredSize:d.size.peek(),filteredSize:0}),k=f.V(),l=a.observable(),p=a.pureComputed(function(){if(b.peek())return b();b(!0);var a=c.ua().normalize();window.setTimeout(function(){if(!a.T(c.ua().normalize()))return b(!1);d.t.issue(a).then(function(a){var b=[];a.values.reduce(function(a,d){return b.push(d)});l(b);delete a.values;d.n(a.unfilteredSize);h(a)}).then(function(){return b(!1)},function(){return b(!1)})})}),q=a.pureComputed(function(){p();
var a=l(),a=f.V(a);r?(r=a.map(function(a){d.Aa(a);return d.b.s(a)}),k.forEach(function(a){d.Ba(a);d.b.p(a)})):(a.forEach(d.Aa.bind(d)),k.forEach(d.Ba.bind(d)));return k=a});this.e=q;var r=null;this.l=a.pureComputed(function(){q();r||(r=k.map(d.b.s));return r});this.l.subscribe(function(){return r=null},null,"asleep");this.h=a.pureComputed(function(){return b()});this.t=a.pureComputed(function(){return h()});this.a=a.pureComputed(function(){return h().filteredSize});this.b=a.pureComputed(function(){return q().size()});
this.n=function(){p.dispose();e()}}var a=r,f=v,k=A,l=p.d.J;c.prototype={get size(){return this.H},Aa:function(a){var c=this.h(a);l(this.e,c)?(c=this.e[c],++c.v,c.value=a):this.e[c]={v:1,value:a}},Ba:function(a){a=this.h(a);if(!l(this.e,a))throw Error("Assertion error: Value with id `"+a+"` was expected to be referenced.");0===--this.e[a].v&&delete this.e[a]},L:function(a){a=(a||function(a){return a})(new y);var c=k.Z.Ga(a),f=p.m.da(this.a,function(a){return c.T(a.key)});if(f)return f.s().view;a=new e(this,
a,function(){return b.p()});var b=new k.xa(c,a,function(){return this.a.splice(this.a.indexOf(b),1)}.bind(this));this.a.push(b);return a},N:function(a){a=(a||function(a){return a})(new y);return this.t.issue(a.ua().normalize())},dispose:function(){if(this.a.length){var a=this.a.length,c=this.a.reduce(function(a,b){return a+b.v},0);window.console.warn("Some views were not or are not yet disposed ("+a+" views, "+c+" references).")}}};c.prototype=p.d.extend({},k.prototype,{get size(){return this.size},
dispose:c.prototype.dispose,openView:c.prototype.L,streamValues:c.prototype.N},c.prototype);e.prototype={get na(){return this.h},get oa(){return this.a},get qa(){return this.t},get K(){return this.l},get size(){return this.b},get values(){return this.e},dispose:function(){this.n()}};e.prototype=p.d.extend({},{get dirty(){return this.na},get filteredSize(){return this.oa},get metadata(){return this.qa},get observables(){return this.K},get size(){return this.size},get values(){return this.values},dispose:e.prototype.dispose},
e.prototype);return c}({});return function(c){return c}(function(c,e,a,f,k){return{ClientSideDataSource:c,DefaultObservableStateTransitioner:e,ObservableEntries:a,ServerSideDataSource:f,streams:k}}(q,u,x,E,function(c,e){return{streamArray:function(a){return new e(c.V(a))}}}(v,B)))}"function"===typeof define&&define.amd?define(["knockout"],C):window["ko-data-source"]=C(window.ko);