/*
 Copyright (c) 2015, Ben Schulz
 License: BSD 3-clause (http://opensource.org/licenses/BSD-3-Clause)
*/
var n;
function G(r){var q,v,D,w,t,p,x,H,E,F,z,y;q=function(){var g;g=function(){function e(a,h){return Object.prototype.hasOwnProperty.call(a,h)}return{Lb:function(a,h){if(a===h)return!0;var k=!!h&&"function"===typeof h.valueOf;return!!a&&"function"===typeof a.valueOf&&k&&a.valueOf()===h.valueOf()},extend:function(a,h){Array.prototype.slice.call(arguments,1).forEach(function(k){for(var b=Object.keys(k),c=0,f=b.length;c<f;c++){var l=b[c],B=Object.getOwnPropertyDescriptor(k,l);void 0!==B&&B.enumerable&&Object.defineProperty(a,
l,B)}});return a},Da:function(a,h){for(var k in a)e(a,k)&&h(k,a[k])},v:e,Vb:function(a,h){var k={},b;for(b in a)e(a,b)&&(k[b]=h(a[b],b,a));return k}}}();return function(e){return e}(function(e,a,h){return{o:e,a:a,qa:h}}(function(e){function a(c){return c.filter(function(f,l,c){return c.lastIndexOf(f)===l})}function h(c,f){for(var l=c.length,a=-1,d=0;d<l;++d)if(f(c[d])){if(0<=a)throw Error("Multiple elements match the predicate.");a=d}return a}function k(c,f){return c&&"function"===typeof c.valueOf&&
f&&"function"===typeof f.valueOf?c.valueOf()<=f.valueOf()?c.valueOf()<f.valueOf()?-1:0:1:c<=f?c<f?-1:0:1}function b(c,f){var l=c.length,a=Array(l),d=Array(l),m;for(m=0;m<l;++m)a[m]=m,d[m]=c[m];m=c;c=d;d=m;a.sort(function(d,m){return f(c[d],c[m])||d-m});for(m=0;m<l;++m)d[m]=c[a[m]];return d}return{contains:function(a,f){return 0<=a.indexOf(f)},Ob:function(c){if(50<c.length){for(var f=c.length,l={},b,d=0;d<f;++d)if(b=c[d],"string"===typeof b)if(e.v(l,b))break;else l[b]=!0;else if(c.lastIndexOf(b)!==
d)break;if(!(d>=f)){for(var m=c.slice(0,d);d<f;++d)b=c[d],"string"===typeof b?e.v(l,b)||(l[b]=!0,m.push(b)):c.lastIndexOf(b)===d&&m.push(b);c=m}}else c=a(c);return c},Pb:function(a,f){return Array.prototype.concat.apply([],a.map(f))},gb:function(a,f){var b=h(a,f);if(0>b)throw Error("None of the elements matches the predicate.");return a[b]},oa:function(a,f){var b=h(a,f);return 0<=b?a[b]:null},Ga:function(a,f){var l=f||k;window.chrome?l=b(a,l):(a.sort(l),l=a);return l}}}(g),g,{Mb:function(e){return e.replace(/([A-Z])/g,
function(a){return"-"+a.toLowerCase()})},Nb:function(e){return e.replace(/-([a-z])/g,function(a){return a[1].toUpperCase()})},format:function(e){var a=arguments;return e.replace(/{(\d+)}/g,function(h,k){var b=parseInt(k,10)+1;return typeof a.length<=b?h:a[b]})}}))}();v=function(g){return function(e){return e}(function(e){function a(a){var c={get length(){return this.length},contains:function(f){return 0<=this.Ha(f)},filter:function(f){for(var a=this.length,b=[],d=0;d<a;++d){var m=this.get(d);f(m,
d,this)&&b.push(m)}return new h(b)},forEach:function(a){for(var b=this.length,c=0;c<b;++c)a(this.get(c),c,this)},get:function(a){return this.get(a)},map:function(a){for(var b=this.length,c=Array(b),d=0;d<b;++d)c[d]=a(this.get(d),d,this);return new h(c)},readOnly:function(){return new k(this)},reduce:function(a,b){var c=1<arguments.length,d=this.length;if(!c&&0===d)throw new TypeError("An empty list can not be reduced, specify an initial value.");for(var m=c?b:this.get(0),c=c?0:1;c<d;++c)m=a(m,this.get(c));
return m},slice:function(a,b){var c=this.length;a=0>=arguments.length?0:0<=a?a:c+a;b=1>=arguments.length?c:0<=b?b:c+b;for(var c=b-a,d=Array(c),m=0;m<c;++m)d[m]=this.get(a+m);return new h(d)},J:function(){for(var a=this.length,b=Array(a),c=0;c<a;++c)b[c]=this.get(c);return b},Ha:function(a){for(var b=this.length,c=0;c<b;++c)if(this.get(c)===a)return c;return-1}};return e.a.extend(c,{get length(){return this.length},contains:c.contains,filter:c.filter,forEach:c.forEach,get:function(a){return this.get(a)},
map:c.map,readOnly:c.readOnly,reduce:c.reduce,slice:c.slice,toArray:c.J,tryFirstIndexOf:c.Ha},a)}function h(a){this.va=a}function k(a){this.W=a}h.prototype=a({get length(){return this.va.length},get:function(a){return this.va[a]},J:function(){return this.va.slice()}});k.prototype=a({get length(){return this.W.length},get:function(a){return this.W.get(a)}});return{ba:function(a){return new h(a||[])},Ya:a}}(g))}(q);D=function(g,e){return function(a){return a}(function(a,h){function k(d){if("string"!==
typeof d)throw Error("Ids must be strings. (given: `"+d+"`, type: `"+typeof d+"`)");return d}function b(d,m){return a.a.v(d,k(m))?d[m]:-1}function c(d,a){var c=b(d,a);if(0>c)throw Error("No element with id `"+a+"`.");return c}function f(d,a,c,b,k){if(b>=k)return b;var l=Math.floor((b+k)/2);return 0>a(c,d[l])?f(d,a,c,b,l):f(d,a,c,l+1,k)}function l(d,a,c,b,f){function k(b,f){var J=l.length,e=a.slice(b,f);l=l.concat(e);e.forEach(function(a){c[d(a)]=J;++J})}var l=[],e=0;b.forEach(function(d){k(e,d);e=
d;f(l)});k(e,a.length);return l}function e(d){this.B=function(a){return k(d(a))};this.m=[];this.p={};this.u=null}e.prototype=h.Ya({get length(){return this.m.length},get:function(d){return this.m[d]},Ua:function(d){return this.m[c(this.p,d)]},bc:function(d){d=b(this.p,d);return 0<=d?this.m[d]:null},clear:function(){this.m=[];this.p={}},contains:function(d){d=(0,this.B)(d);return 0<=b(this.p,d)},za:function(d){return 0<=b(this.p,d)},removeAll:function(d){this.fb(d.map(this.B))},fb:function(d){if(d.length){var a=
this.B,b=this.m,f=this.p;d=d.map(function(d){return c(f,d)+1});d.sort(function(d,a){return d-a});this.m=l(a,b,f,d,function(d){d=d.pop();d=a(d);delete f[d]})}},hb:function(d){var m=this.B,b=this.m,c=this.p;this.u=d;a.o.Ga(b,d);d=!1;for(var f=0;f<b.length;++f){var l=m(b[f]);d=d||c[l]!==f;c[l]=f}return d},ra:function(d){if(this.u)throw Error("`updateAll` must not be called on a sorted `IndexedTable`. Use a combination of order-preserving `tryUpdateAll`, `removeAll` and `insertAll` instead.");if(d.length){var a=
this.B,b=this.m,f=this.p;d.forEach(function(d){var l=c(f,a(d));b[l]=d})}},jb:function(d){if(!this.u)throw Error("`tryUpdateAll` is designed for sorted `IndexedTable`s. For unsorted ones, use `updateAll` instead.");if(!d.length)return[];var a=this.B,b=this.m,f=this.p,l=this.u,k=[];d.forEach(function(d){var e=c(f,a(d));0!==l(d,b[e])?k.push(d):b[e]=d});return k},G:function(d){if(this.u)throw Error("`addAll` must not be called on an sorted `IndexedTable`. Use order-preserving `insertAll` instead.");if(d.length){var b=
this.B,c=this.m,f=this.p;d.forEach(function(d){var l=b(d);if(a.a.v(f,l))throw Error("The list already contains an element with id `"+l+"`. Did you mean to call `updateAll`?.");f[l]=c.push(d)-1})}},Wa:function(d){if(!this.u)throw Error("`insertAll` is designed for sorted `IndexedTable`s. For unsorted ones, use `addAll` instead.");if(d.length){var b=this.B,c=this.m,k=this.p,e=this.u;a.o.Ga(d,e);var h=0,g=[];d.forEach(function(d){d=f(c,e,d,h,c.length);g.push(d);h=d});h=0;this.m=l(b,c,k,g,function(a){var c=
d[h],f=b(c),l=a.length;a.push(c);k[f]=l;++h})}}});return e}(e,g))}(v,q);w=function(){function g(e,a,h){this.Y=e||[];this.ea=a||[];this.da=h||[]}g.prototype={get size(){return this.Y.length+this.ea.length+this.da.length},get empty(){return!this.size},I:function(e){this.empty||e(this)}};return g}();t={};p=function(g,e,a,h,k){function b(b,f,l){this.ia=b;this.h=f||new a(b.X);this.F=l||g.observable(new h);this.ya=g.observable(this.h.readOnly());this.L=null;this.n=g.pureComputed(function(){this.ya();this.L||
(this.L=this.h.map(this.r.s));return this.L}.bind(this));this.n.subscribe(function(){return this.L=null}.bind(this),null,"asleep")}b.prototype={get X(){return this.ia.X},get r(){return this.ia.r},get values(){return this.ya},get P(){return this.n},ja:function(a){this.L&&(a.Y.forEach(this.r.s),this.L=this.h.map(this.r.Tb),a.da.forEach(this.r.q));this.ya.valueHasMutated()},xa:function(){this.n&&this.h.forEach(this.r.q)},aa:function(){this.ia.aa();this.ha()},O:function(a){return new k.ob(this,a)},R:function(a){return new k.yb(this,
a)},Qa:function(a,b){return new k.kb(this,a,b)}};return b}(r,q,D,w,t);x=function(g,e,a){function h(k,b,c,f){a.call(this,{X:k,r:b},c,f);this.U=f.subscribe(function(a){this.ja(a)}.bind(this))}h.prototype=e.a.extend({},a.prototype,{aa:function(){},dispose:function(){this.U.dispose();this.xa()}});return h}(r,q,p);(function(g,e,a,h,k){function b(b,f){h.call(this,b);var l=g.observable(g.unwrap(f));this.ha=function(){return l(g.unwrap(f))};this.T=g.computed(function(){l();var b=g.unwrap(f);l(b);var d=this.h.J(),
b=this.ia.h.filter(b).J(),d=new a(b,[],d);this.h.clear();this.h.G(b);this.ja(d);d.I(this.F)}.bind(this));this.U=b.F.subscribe(function(b){var d;d=this.X;for(var m=this.h,c=g.unwrap(f),l=b.Y.filter(c),k=[],e=b.da.filter(c),h=0,q=b.ea.length;h<q;h++){var p=b.ea[h],r=m.za(d(p));c(p)?r?k.push(p):l.push(p):r&&e.push(p)}d=new a(l,k,e);d.empty||(this.h.removeAll(d.da),this.h.ra(d.ea),this.h.G(d.Y),this.ja(b),d.I(this.F))}.bind(this))}b.prototype=e.a.extend({},h.prototype,{dispose:function(){this.T.dispose();
this.U.dispose();this.xa()}});return k.ob=b})(r,q,w,p,t);(function(g,e,a,h){function k(b,c){a.call(this,b);this.h.G(b.h.J());var f=g.observable(g.unwrap(c));this.ha=function(){return f(g.unwrap(c))};this.T=g.computed(function(){f();var a=g.unwrap(c);f(a);this.h.hb(a)&&this.F.valueHasMutated()}.bind(this));this.U=b.F.subscribe(function(a){var b=this.h.jb(a.ea);this.h.removeAll(a.da.concat(b));this.h.Wa(a.Y.concat(b));this.ja(a);this.F.valueHasMutated()}.bind(this))}k.prototype=e.a.extend({},a.prototype,
{O:function(){throw Error("Filtering a sorted view is not supported.");},R:function(){throw Error("Sorting a sorted view is not supported.");},dispose:function(){this.T.dispose();this.U.dispose();this.xa()}});return h.yb=k})(r,q,p,t);(function(g,e,a,h){function k(b,c,f){function k(){return{offset:g.unwrap(c),g:g.unwrap(f)}}var e=b.r;this.wa=b;this.c=g.observable(a.ba());this.n=null;var d=b.X,m=g.observable(k());this.ha=function(){var d=m(),a=k();d.offset===a.offset&&d.g===a.g||m(a)};this.T=g.computed(function(){b.F();
m();var a=k();m(a);var c=b.h,f=Math.min(c.length,a.offset),h=Math.min(c.length,f+a.g),a=this.c.peek(),c=c.slice(f,h);a:if(a.length!==c.length)f=!0;else{for(f=a.length-1;0<=f;--f)if(d(a.get(f))!==d(c.get(f))){f=!0;break a}f=!1}f&&(this.c(c),this.n&&(this.n(this.c.peek().map(e.s)),a.forEach(e.q)))}.bind(this))}k.prototype={get values(){return this.c},get P(){this.n||(this.n=g.observable(this.values().map(this.wa.r.s)));return this.n},aa:function(){this.wa.aa();this.ha()},O:function(){throw Error("Filtering a clipped view is not supported.");
},R:function(){throw Error("Sorting a clipped view is not supported.");},Qa:function(){throw Error("Clipping a clipped view is not supported.");},dispose:function(){this.T.dispose();this.n&&this.c().forEach(this.wa.r.q)}};return h.kb=k})(r,q,v,t);H={wb:x};t=function(g){function e(a,k,b){this.f=a;this.b=b?function(a,f){var e=k(f);try{return a(e)}finally{b(e)}}:function(a,b){return a(k(b))}}e.prototype={forEach:function(a){this.f.forEach(this.b.bind(null,a))},map:function(a){return new e(this,a)},reduce:function(a,
k){return this.f.reduce(function(b,c){return a(b,this.b(function(a){return a},c))}.bind(this),k)}};var a=e.prototype;g.a.extend(a,{forEach:a.forEach,map:a.map,reduce:a.reduce});return e}(q);E=function(g,e,a){function h(){return 0}function k(){return!0}function b(d,a){this.e=d;this.b=a}function c(d){this.f=d;this.b=null}function f(d,a,b){this.e=d;this.Qb=a;this.Rb=b;this.Sa=!1;this.t=this.b=this.f=this.Ba=null}function l(d,a,b,c){this.i=d||k;this.j=a||h;this.offset=b||0;this.g=c||0===c?c:Number.POSITIVE_INFINITY;
this.D=Math.max(this.i===k?l.b:l.Ka,this.j===h?l.b:l.t,0===this.offset&&this.g===Number.POSITIVE_INFINITY?l.b:l.f)}function B(d,a,b){this.key=d;this.view=a;this.w=1;this.b=b}b.prototype={ab:function(a){return new c(this.Fa(a))},Fa:function(a){return new f(this.e,this.b,a)},ib:function(d){return this.S(d).then(function(d){return new a(d,this.e.s.bind(this.e),this.e.q.bind(this.e))}.bind(this))},Q:function(){throw Error("`"+this.constructor+"` does not implement `openView`.");},S:function(){throw Error("`"+
this.constructor+"` does not implement `streamValues`.");},dispose:function(){throw Error("`"+this.constructor+"` does not implement `dispose`.");}};b.prototype=e.a.extend({},{openEntryView:b.prototype.ab,openOptionalEntryView:b.prototype.Fa,streamObservables:b.prototype.ib},b.prototype);c.prototype={get value(){return this.f.value},get observable(){this.b||(this.b=this.f.C.subscribe(function(){throw Error("Illegal state: A non-optional view for this entry is still open.");}));return this.f.observable},
dispose:function(){this.b&&this.b.dispose();this.f.dispose()}};c.prototype=e.a.extend({},{get value(){return this.value},get observable(){return this.observable},dispose:c.prototype.dispose},c.prototype);f.prototype={N:function(){if(this.Sa)throw Error("Illegal state: Entry view was already disposed.");},get value(){this.N();return this.Ba=this.Qb(this.Rb)},get observable(){this.N();return(this.f||this.C)&&this.f},get C(){this.N();if(this.b)return this.b;var a=this.e.Hb(this.value);this.f=a();this.b=
g.observable({present:!0,observable:this.f});this.t=a.subscribe(function(a){this.b({present:!!a,observable:a})}.bind(this));return this.b},dispose:function(){this.N();this.Sa=!0;this.t&&(this.t.dispose(),this.e.q(this.Ba),this.Ba=this.f=this.b=this.t=null)}};f.prototype=e.a.extend({},{get value(){return this.value},get observable(){return this.observable},get optionalObservable(){return this.C},dispose:f.prototype.dispose},f.prototype);l.b=0;l.Ka=1;l.t=2;l.f=3;l.Ta=function(a){return new l(a.i,a.j,
a.offset,a.g)};l.prototype={$:function(a){return this.D===a.D&&this.i===a.i&&this.j===a.j&&this.offset===a.offset&&this.g===a.g},cb:function(){if(0>=this.D)throw Error("Unsupported operation.");var a=[null,this.i,this.j].slice(0,this.D);return new (l.bind.apply(l,a))},Pa:function(){return 0===this.D?[this]:this.cb().Pa().concat([this])},Kb:function(a){var b=[[this.i],[this.j],[this.offset,this.g]][this.D-1];return(0,[function(a){return a.O},function(a){return a.R},function(a){return a.Qa}][this.D-
1])(a).apply(a,b)}};B.prototype={s:function(){if(0>=this.w)throw Error("Assertion error: Reference count at `"+this.w+"`.");++this.w;return this},q:function(){0===--this.w&&this.b();return this}};b.fa=l;b.Ja=B;return b}(r,q,t);F=function(g,e){function a(a){this.W=a}a.prototype={forEach:function(a){this.W.forEach(a)},map:function(a){return new e(this,a)},reduce:function(a,b){return Promise.resolve(this.W.reduce(a,b))}};var h=a.prototype;g.a.extend(h,{forEach:h.forEach,map:h.map,reduce:h.reduce});return a}(q,
t);t=function(g){function e(a){this.V=!1;(a&&a.observableProperties||[]).forEach(function(a){this.V=this.V||{};this.V[a]=!0}.bind(this))}e.prototype={constructor:function(a){var e=this.V;if(!e)return a;var k={};Object.keys(a).forEach(function(b){k[b]=e&&e[b]?g.observable(a[b]):a[b]});return k},updater:function(a,e){var k=this.V;if(!k)return a;Object.keys(e).filter(function(a){return k&&k[a]}).forEach(function(b){return a[b](e[b])});return a},destructor:function(){}};return e}(r);z=function(g,e,a){function h(a){this.observable=
a;this.C=g.observable(a);this.eb=1}return function(k,b){function c(a){if("string"!==typeof a)throw l(a);if(e.a.v(d,a))return d[a];throw Error("No entry for id `"+a+"`.");}function f(a){var c=k(a);if("string"!==typeof c)throw l(c);Object.prototype.hasOwnProperty.call(d,c)?(c=d[c],++c.eb):(a=new h(b.constructor(a)),c=d[c]=a);return c}function l(a){throw Error("Illegal argument: Ids must be strings ('"+a+"' is of type '"+typeof a+"').");}function g(a){var d=a.observable;a.C(null);a.observable=null;b.destructor(d)}
b=b||new a;var d={};this.s=function(a){return f(a).observable};this.Hb=function(a){return f(a).C};this.q=function(a){a=k(a);var b=c(a);0===--b.eb&&(g(b),delete d[a])};this.Tb=function(a){return c(k(a)).observable};this.bb=function(a){a.forEach(function(a){var c=k(a);e.a.v(d,c)&&(c=d[c],c.observable||(c.observable=b.constructor(a),c.C(c.observable)))})};this.sa=function(a){a.forEach(function(a){var c=k(a);e.a.v(d,c)&&b.updater(d[c].observable,a)})};this.Xb=function(a){e.a.Da(d,function(d,c){var f=
a(d);f?c.observable?b.updater(c.observable,f):(c.observable=b.constructor(f),c.C(c.observable)):g(c)})};this.Ra=function(a){e.a.Da(d,function(d,b){a(d)&&g(b)})};this.dispose=function(){this.Ra(function(){return!0})}.bind(this)}}(r,q,t);p=function(g){var e,a,h;e=function(a){return function(b,c){return a.a.extend(b,{get stringifyable(){return c()}})}}(g);a=function(a,b){function c(){return 0}function f(a,d){return"string"===typeof a&&"string"===typeof d?a.localeCompare(d):a<=d?a<d?-1:0:1}function e(b,
c){a.a.extend(b,{get onResultOf(){return this.ca},get reverse(){return this.reverse},get callable(){return this.Z}},{get ca(){return function(a){return g(a,b)}},get reverse(){return function(){return c||d(b)}},get Z(){return b}})}function g(a,d){function c(b,f){return d(a(b),a(f))}e(c);b(c,function(){return{type:"by-function-comparator","function":a.stringifyable,comparator:d.stringifyable}});return c}function d(a){function d(b,c){return-a(b,c)}e(d,a);b(d,function(){return{type:"reversed-comparator",
comparator:a.stringifyable}});return d}e(f);b(f,function(){return{type:"natural-comparator"}});e(c);b(c,function(){return{type:"indifferent-comparator"}});return{Sb:c,b:f}}(g,e);h=function(a,b){function c(b){a.a.extend(b,{get callable(){return this.Z}},{get Z(){return b}})}return{Wb:function(a){function e(b){return b[a]}c(e);b(e,function(){return{type:"property-accessor",propertyName:a}});return e}}}(g,e);g=function(a,b){function c(){return!0}function f(){return!1}function e(b,c){a.a.extend(b,{get and(){return this.ka},
get negate(){return this.Za},get onResultOf(){return this.ca},get or(){return this.na},get callable(){return this.Z}},{get ka(){return function(a){return g([b,a])}},get Za(){return function(){return c||h(b)}},get ca(){return function(a){return d(a,b)}},get na(){return function(a){return I([b,a])}},get Z(){return b}})}function g(a){function d(b){for(var c=0,f=a.length;c<f;++c)if(!a[c](b))return!1;return!0}if(!a.length)return c;e(d);b(d,function(){return{type:"and-predicate",components:a.map(function(a){return a.stringifyable})}});
return d}function d(a,d){function c(b){return d(a(b))}e(c);b(c,function(){return{type:"by-function-predicate","function":a.stringifyable,predicate:d.stringifyable}});return c}function h(a){function d(b){return!a(b)}e(d,a);b(d,function(){return{type:"negated-predicate",predicate:a.stringifyable}});return d}function I(a){function d(b){for(var c=0,f=a.length;c<f;++c)if(a[c](b))return!0;return!1}if(!a.length)return f;e(d);b(d,function(){return{type:"or-predicate",components:a.map(function(a){return a.stringifyable})}});
return d}e(f);b(f,function(){return{type:"always-false-predicate"}});e(c);b(c,function(){return{type:"always-true-predicate"}});return{b:f,Jb:c,ka:g,f:function(a,d){function c(d){return a(d)}e(c);b(c,d);return c},na:I,Yb:function(a){function d(b){return a.test(b)}e(d);b(d,function(){return{type:"regular-expression-predicate",regularExpression:a.source,caseSensitive:!a.ignoreCase,multiline:a.multiline}});return d}}}(g,e);return function(a){return a}({M:a,la:h,H:g,Ub:e,ac:function(a,b){return"function"===
typeof b||"object"===typeof b?b.stringifyable||b:b}})}(q);p=function(g,e,a){function h(a,b,c,f){this.Eb=a;this.u=b;this.Db=c;this.Cb=f}h.prototype=e.a.extend({get predicate(){return this.i},get comparator(){return this.j},get offset(){return this.offset},get limit(){return this.g}},{get i(){return this.Eb},get j(){return this.u},get offset(){return this.Db},get g(){return this.Cb},normalize:function(){return new h(this.i||a.H.Jb,this.j||a.M.Sb,this.offset||0,this.g||0===this.g?this.g:Number.POSITIVE_INFINITY)},
Ia:function(){return new h(g.unwrap(this.i),g.unwrap(this.j),g.unwrap(this.offset),g.unwrap(this.g))},$:function(a){return this.i===a.i&&this.j===a.j&&this.offset===a.offset&&this.g===a.g}});return h}(r,q,p);p=function(g,e){function a(a,b,c){e.call(this,a,b,c)}var h={Xa:function(a){return new e(this.i,this.j,this.offset,a)}};a.prototype=g.a.extend({},e.prototype,h,{limitedTo:h.Xa});return a}(q,p);p=function(g,e){function a(a,b){e.call(this,a,b)}var h={$a:function(a){return new e(this.i,this.j,a)}};
a.prototype=g.a.extend({},e.prototype,h,{offsetBy:h.$a});return a}(q,p);p=function(g,e){function a(a){e.call(this,a)}var h={R:function(a){return new e(this.i,a)}};a.prototype=g.a.extend({},e.prototype,h,{sortedBy:h.R});return a}(q,p);p=function(g,e){function a(){e.call(this)}var h={O:function(a){return new e(a)}};a.prototype=g.a.extend({},e.prototype,h,{filteredBy:h.O});return a}(q,p);y=function(g,e){function a(){e.call(this)}a.prototype=g.a.extend({},e.prototype);return a}(q,p);p=function(){function g(d,
e){e=e||new l(d);var g=new f(d);b.call(this,e,function(a){return g.Ua(a)});this.ga=d;this.e=e;this.c=g;this.K=a.observable(new c);this.l=[];var h=new k.wb(this.ga,this.e,this.c,this.K);this.Fb=this.La(new b.fa,h);this.A=a.pureComputed(function(){return h.values().length})}function e(d,c){this.b=d;this.t=c;this.A=a.pureComputed(function(){return d.values().length});this.f=a.pureComputed(function(){return(h.o.oa(c,function(a){return a.key.D===b.fa.Ka})||c[0]).view.values().length})}var a=r,h=q,k=H,
b=E,c=w,f=D,l=z;g.prototype={get size(){return this.A},La:function(a,c){var f=new b.Ja(a,c,function(){return this.l.splice(this.l.indexOf(f),1)}.bind(this));this.l.push(f);return f},Bb:function(a){var b=h.o.oa(this.l,function(b){return a.$(b.key)});if(b)return b.s();var c=a.cb(),b=h.o.gb(this.l,function(a){return c.$(a.key)}).view,b=a.Kb(b);return this.La(a,b)},Gb:function(a){this.c.G(a);(new c(a)).I(this.K);this.e.bb(a)},Ib:function(a){var b=[],f=[];a.forEach(function(a){return(this.c.contains(a)?
f:b).push(a)}.bind(this));this.c.G(b);this.c.ra(f);(new c(b,f)).I(this.K);this.e.bb(b);this.e.sa(f)},Q:function(a){a=(a||function(a){return a})(new y);a=b.fa.Ta(a).Pa().map(function(a){return this.Bb(a)}.bind(this));var c=a[a.length-1].view;c.aa();return new e(c,a)},Zb:function(a){this.c.removeAll(a);(new c([],[],a)).I(this.K);this.e.Ra(function(a){return!this.c.za(a)}.bind(this))},$b:function(a){var b=this.c.J();this.c.clear();this.c.G(a);(new c(a,[],b)).I(this.K);this.e.Xb(function(a){return this.c.bc(a)}.bind(this))},
S:function(a){a=this.Q(a);try{return Promise.resolve(new F(a.values.peek().slice()))}finally{a.dispose()}},sa:function(a){this.c.ra(a);(new c([],a)).I(this.K);this.e.sa(a)},dispose:function(){this.Fb.q();this.e.dispose();if(this.l.length){var a=this.l.length,b=this.l.reduce(function(a,b){return a+b.w},0);window.console.warn("Some views were not or are not yet disposed ("+a+" views, "+b+" references).")}}};g.prototype=h.a.extend({},b.prototype,{get size(){return this.size},addEntries:g.prototype.Gb,
dispose:g.prototype.dispose,addOrUpdateEntries:g.prototype.Ib,openView:g.prototype.Q,removeEntries:g.prototype.Zb,replaceEntries:g.prototype.$b,streamValues:g.prototype.S,updateEntries:g.prototype.sa},g.prototype);var p=a.pureComputed(function(){return!1});e.prototype={get Aa(){return p},get Ca(){return this.f},get Ea(){return a.pureComputed(function(){return{}})},get P(){return this.b.P},get size(){return this.A},get values(){return this.b.values},dispose:function(){this.t.forEach(function(a){a.q()})}};
e.prototype=h.a.extend({get dirty(){return this.Aa},get filteredSize(){return this.Ca},get metadata(){return this.Ea},get observables(){return this.P},get size(){return this.size},get values(){return this.values},dispose:e.prototype.dispose},e.prototype);return g}({});x=function(){function g(f,e,g){g=g||new b(f);var d={};k.call(this,g,function(a){if(!c(d,a))throw Error("No known entry with id `"+a+"`.");return d[a].value});this.ga=f;this.e=g;this.Na=e;this.c=d;this.A=a.observable(0);this.Ab=a.pureComputed(function(){return this.A()}.bind(this));
this.l=[]}function e(b,c,e){function d(a){if(a.i!==w||a.j!==x)return!1;for(var b=0,d=u.length;b<d;++b){var c=A[b];if(u[b]<=a.offset&&c>=a.offset+a.g)return!0}return!1}function g(a,b){if(a.i!==w||a.j!==x){var d=a.i,c=a.j;v=[];u=[];A=[];w=d;x=c}var c=d=a.offset,f=d+a.g,e,h,l;h=e=0;for(l=u.length;e<l;++e){var k=u[h]=u[e],m=A[h]=A[e];c<=m&&f>=k?(c=Math.min(k,c),f=Math.max(m,f)):++h}u.length=A.length=h;u.push(c);A.push(f>=p().filteredSize?Number.POSITIVE_INFINITY:f);e=0;for(l=b.length;e<l;++e)v[d+e]=b[e];
window.console.log("Cache ranges:");e=0;for(l=u.length;e<l;++e)window.console.log("["+u[e]+", "+A[e]+"]")}var k=a.observable(!1),q=a.observable(!1),p=a.observable({unfilteredSize:b.size.peek(),filteredSize:0}),r=h.ba(),t=a.observable(),v=[],u=[],A=[],w=null,x=null,z=a.pureComputed(function(){if(k.peek())return k();var a=c.Ia().normalize();if(d(a))return t(v.slice(a.offset,a.offset+a.g));q(!0);k(!0);window.setTimeout(function(){if(!a.$(c.Ia().normalize()))return k(!1);b.Na.issue(a).then(function(d){var c=
[];d.values.reduce(function(a,b){return c.push(b)});t(c);delete d.values;b.A(d.unfilteredSize);p(d);g(a,c)}).then(function(){q(!1);k(!1)},function(){k(!1)})})}),y=a.pureComputed(function(){z();var a=t(),a=h.ba(a);C?(C=a.map(function(a){b.Ma(a);return b.e.s(a)}),r.forEach(function(a){b.Oa(a);b.e.q(a)})):(a.forEach(b.Ma.bind(b)),r.forEach(b.Oa.bind(b)));return r=a});this.c=y;var C=null;this.n=a.pureComputed(function(){y();C||(C=r.map(b.e.s));return C});this.n.subscribe(function(){return C=null},null,
"asleep");this.f=a.pureComputed(function(){return q()});this.N=a.pureComputed(function(){return p()});this.b=a.pureComputed(function(){return p().filteredSize});this.A=a.pureComputed(function(){return y().length});this.t=function(){z.dispose();e()}}var a=r,h=v,k=E,b=z,c=q.a.v;g.prototype={get size(){return this.Ab},Ma:function(a){var b=this.ga(a);c(this.c,b)?(b=this.c[b],++b.w,b.value=a):this.c[b]={w:1,value:a}},Oa:function(a){a=this.ga(a);if(!c(this.c,a))throw Error("Assertion error: Value with id `"+
a+"` was expected to be referenced.");0===--this.c[a].w&&delete this.c[a]},Q:function(a){a=(a||function(a){return a})(new y);var b=k.fa.Ta(a),c=q.o.oa(this.l,function(a){return b.$(a.key)});if(c)return c.s().view;a=new e(this,a,function(){return d.q()});var d=new k.Ja(b,a,function(){return this.l.splice(this.l.indexOf(d),1)}.bind(this));this.l.push(d);return a},S:function(a){a=(a||function(a){return a})(new y);return this.Na.issue(a.Ia().normalize())},dispose:function(){this.e.dispose();if(this.l.length){var a=
this.l.length,b=this.l.reduce(function(a,b){return a+b.w},0);window.console.warn("Some views were not or are not yet disposed ("+a+" views, "+b+" references).")}}};g.prototype=q.a.extend({},k.prototype,{get size(){return this.size},dispose:g.prototype.dispose,openView:g.prototype.Q,streamValues:g.prototype.S},g.prototype);e.prototype={get Aa(){return this.f},get Ca(){return this.b},get Ea(){return this.N},get P(){return this.n},get size(){return this.A},get values(){return this.c},dispose:function(){this.t()}};
e.prototype=q.a.extend({},{get dirty(){return this.Aa},get filteredSize(){return this.Ca},get metadata(){return this.Ea},get observables(){return this.P},get size(){return this.size},get values(){return this.values},dispose:e.prototype.dispose},e.prototype);return g}({});return function(g){return g}(function(g,e,a,h,k){return{ClientSideDataSource:g,DefaultObservableStateTransitioner:e,ObservableEntries:a,ServerSideDataSource:h,streams:k}}(p,t,z,x,function(g,e){return{streamArray:function(a){return new e(g.ba(a))}}}(v,
F)))}"function"===typeof define&&define.amd?define(["knockout"],G):window["ko-data-source"]=G(window.ko);