/*
 Copyright (c) 2015, Ben Schulz
 License: BSD 3-clause (http://opensource.org/licenses/BSD-3-Clause)
*/
var n;
function F(r){var p,v,y,z,u,q,w,G,D,E,x,A;p=function(){var d;d=function(){function f(a,f){return Object.prototype.hasOwnProperty.call(a,f)}return{Nb:function(a,f){if(a===f)return!0;var k=!!f&&"function"===typeof f.valueOf;return!!a&&"function"===typeof a.valueOf&&k&&a.valueOf()===f.valueOf()},extend:function(a,f){Array.prototype.slice.call(arguments,1).forEach(function(k){for(var g=Object.keys(k),c=0,e=g.length;c<e;c++){var l=g[c],t=Object.getOwnPropertyDescriptor(k,l);void 0!==t&&t.enumerable&&Object.defineProperty(a,
l,t)}});return a},Ca:function(a,d){for(var k in a)f(a,k)&&d(k,a[k])},v:f,Xb:function(a,d){var k={},g;for(g in a)f(a,g)&&(k[g]=d(a[g],g,a));return k}}}();return function(f){return f}(function(f,a,d){return{o:f,a:a,pa:d}}(function(f){function a(c){return c.filter(function(e,l,c){return c.lastIndexOf(e)===l})}function d(c,e){for(var l=c.length,a=-1,b=0;b<l;++b)if(e(c[b])){if(0<=a)throw Error("Multiple elements match the predicate.");a=b}return a}function k(c,e){return c&&"function"===typeof c.valueOf&&
e&&"function"===typeof e.valueOf?c.valueOf()<=e.valueOf()?c.valueOf()<e.valueOf()?-1:0:1:c<=e?c<e?-1:0:1}function g(c,e){var l=c.length,a=Array(l),b=Array(l),m;for(m=0;m<l;++m)a[m]=m,b[m]=c[m];m=c;c=b;b=m;a.sort(function(b,m){return e(c[b],c[m])||b-m});for(m=0;m<l;++m)b[m]=c[a[m]];return b}return{contains:function(c,e){return 0<=c.indexOf(e)},Qb:function(c){if(50<c.length){for(var e=c.length,l={},g,b=0;b<e;++b)if(g=c[b],"string"===typeof g)if(f.v(l,g))break;else l[g]=!0;else if(c.lastIndexOf(g)!==
b)break;if(!(b>=e)){for(var m=c.slice(0,b);b<e;++b)g=c[b],"string"===typeof g?f.v(l,g)||(l[g]=!0,m.push(g)):c.lastIndexOf(g)===b&&m.push(g);c=m}}else c=a(c);return c},Rb:function(c,e){return Array.prototype.concat.apply([],c.map(e))},ib:function(c,e){var l=d(c,e);if(0>l)throw Error("None of the elements matches the predicate.");return c[l]},na:function(c,e){var l=d(c,e);return 0<=l?c[l]:null},Ga:function(c,e){var l=e||k;window.chrome?l=g(c,l):(c.sort(l),l=c);return l}}}(d),d,{Ob:function(f){return f.replace(/([A-Z])/g,
function(a){return"-"+a.toLowerCase()})},Pb:function(f){return f.replace(/-([a-z])/g,function(a){return a[1].toUpperCase()})},format:function(f){var a=arguments;return f.replace(/{(\d+)}/g,function(f,k){var g=parseInt(k,10)+1;return typeof a.length<=g?f:a[g]})}}))}();v=function(d){return function(f){return f}(function(f){function a(a){var c={get length(){return this.length},contains:function(e){return 0<=this.Ha(e)},filter:function(e){for(var a=this.length,c=[],b=0;b<a;++b){var m=this.get(b);e(m,
b,this)&&c.push(m)}return new d(c)},forEach:function(e){for(var c=this.length,a=0;a<c;++a)e(this.get(a),a,this)},get:function(e){return this.get(e)},map:function(e){for(var a=this.length,c=Array(a),b=0;b<a;++b)c[b]=e(this.get(b),b,this);return new d(c)},readOnly:function(){return new k(this)},reduce:function(e,a){var c=1<arguments.length,b=this.length;if(!c&&0===b)throw new TypeError("An empty list can not be reduced, specify an initial value.");for(var m=c?a:this.get(0),c=c?0:1;c<b;++c)m=e(m,this.get(c));
return m},slice:function(e,c){var a=this.length;e=0>=arguments.length?0:0<=e?e:a+e;c=1>=arguments.length?a:0<=c?c:a+c;for(var a=c-e,b=Array(a),m=0;m<a;++m)b[m]=this.get(e+m);return new d(b)},J:function(){for(var c=this.length,a=Array(c),g=0;g<c;++g)a[g]=this.get(g);return a},Ha:function(c){for(var a=this.length,g=0;g<a;++g)if(this.get(g)===c)return g;return-1}};return f.a.extend(c,{get length(){return this.length},contains:c.contains,filter:c.filter,forEach:c.forEach,get:function(c){return this.get(c)},
map:c.map,readOnly:c.readOnly,reduce:c.reduce,slice:c.slice,toArray:c.J,tryFirstIndexOf:c.Ha},a)}function d(a){this.ua=a}function k(a){this.V=a}d.prototype=a({get length(){return this.ua.length},get:function(a){return this.ua[a]},J:function(){return this.ua.slice()}});k.prototype=a({get length(){return this.V.length},get:function(a){return this.V.get(a)}});return{aa:function(a){return new d(a||[])},$a:a}}(d))}(p);y=function(d,f){return function(a){return a}(function(a,d){function k(b){if("string"!==
typeof b)throw Error("Ids must be strings. (given: `"+b+"`, type: `"+typeof b+"`)");return b}function g(b,m){return a.a.v(b,k(m))?b[m]:-1}function c(b,a){var c=g(b,a);if(0>c)throw Error("No element with id `"+a+"`.");return c}function e(b,a,c,g,l){if(g>=l)return g;var d=Math.floor((g+l)/2);return 0>a(c,b[d])?e(b,a,c,g,d):e(b,a,c,d+1,l)}function l(b,a,c,e,g){function l(e,g){var f=d.length,k=a.slice(e,g);d=d.concat(k);k.forEach(function(a){c[b(a)]=f;++f})}var d=[],f=0;e.forEach(function(b){l(f,b);f=
b;g(d)});l(f,a.length);return d}function f(b){this.C=function(a){return k(b(a))};this.m=[];this.p={};this.u=null}f.prototype=d.$a({get length(){return this.m.length},get:function(b){return this.m[b]},Wa:function(b){return this.m[c(this.p,b)]},dc:function(b){b=g(this.p,b);return 0<=b?this.m[b]:null},clear:function(){this.m=[];this.p={}},contains:function(b){b=(0,this.C)(b);return 0<=g(this.p,b)},ya:function(b){return 0<=g(this.p,b)},removeAll:function(b){this.hb(b.map(this.C))},hb:function(b){if(b.length){var a=
this.C,e=this.m,g=this.p;b=b.map(function(b){return c(g,b)+1});b.sort(function(b,a){return b-a});this.m=l(a,e,g,b,function(b){b=b.pop();b=a(b);delete g[b]})}},jb:function(b){var c=this.C,e=this.m,g=this.p;this.u=b;a.o.Ga(e,b);b=!1;for(var d=0;d<e.length;++d){var l=c(e[d]);b=b||g[l]!==d;g[l]=d}return b},qa:function(b){if(this.u)throw Error("`updateAll` must not be called on a sorted `IndexedTable`. Use a combination of order-preserving `tryUpdateAll`, `removeAll` and `insertAll` instead.");if(b.length){var a=
this.C,e=this.m,g=this.p;b.forEach(function(b){var d=c(g,a(b));e[d]=b})}},mb:function(b){if(!this.u)throw Error("`tryUpdateAll` is designed for sorted `IndexedTable`s. For unsorted ones, use `updateAll` instead.");if(!b.length)return[];var a=this.C,e=this.m,g=this.p,d=this.u,l=[];b.forEach(function(b){var f=c(g,a(b));0!==d(b,e[f])?l.push(b):e[f]=b});return l},G:function(b){if(this.u)throw Error("`addAll` must not be called on an sorted `IndexedTable`. Use order-preserving `insertAll` instead.");if(b.length){var c=
this.C,e=this.m,g=this.p;b.forEach(function(b){var d=c(b);if(a.a.v(g,d))throw Error("The list already contains an element with id `"+d+"`. Did you mean to call `updateAll`?.");g[d]=e.push(b)-1})}},Ya:function(b){if(!this.u)throw Error("`insertAll` is designed for sorted `IndexedTable`s. For unsorted ones, use `addAll` instead.");if(b.length){var c=this.C,g=this.m,d=this.p,f=this.u;a.o.Ga(b,f);var k=0,h=[];b.forEach(function(b){b=e(g,f,b,k,g.length);h.push(b);k=b});k=0;this.m=l(c,g,d,h,function(a){var e=
b[k],g=c(e),l=a.length;a.push(e);d[g]=l;++k})}}});return f}(f,d))}(v,p);z=function(){function d(d,a,h){this.X=d||[];this.da=a||[];this.ca=h||[]}d.prototype={get size(){return this.X.length+this.da.length+this.ca.length},get empty(){return!this.size},I:function(d){this.empty||d(this)}};return d}();u={};q=function(d,f,a,h,k){function g(c,e,g){this.ha=c;this.g=e||new a(c.W);this.F=g||d.observable(new h);this.xa=d.observable(this.g.readOnly());this.L=null;this.n=d.pureComputed(function(){this.xa();this.L||
(this.L=this.g.map(this.r.s));return this.L}.bind(this));this.n.subscribe(function(){return this.L=null}.bind(this),null,"asleep")}g.prototype={get W(){return this.ha.W},get r(){return this.ha.r},get values(){return this.xa},get P(){return this.n},ia:function(a){this.L&&(a.X.forEach(this.r.s),this.L=this.g.map(this.r.Vb),a.ca.forEach(this.r.q));this.xa.valueHasMutated()},wa:function(){this.n&&this.g.forEach(this.r.q)},$:function(){this.ha.$();this.ga()},O:function(a){return new k.rb(this,a)},R:function(a){return new k.Ab(this,
a)},Sa:function(a,e){return new k.nb(this,a,e)}};return g}(r,p,y,z,u);w=function(d,f,a){function h(d,g,c,e){a.call(this,{W:d,r:g},c,e);this.U=e.subscribe(function(a){this.ia(a)}.bind(this))}h.prototype=f.a.extend({},a.prototype,{$:function(){},dispose:function(){this.U.dispose();this.wa()}});return h}(r,p,q);(function(d,f,a,h,k){function g(c,e){h.call(this,c);var g=d.observable(d.unwrap(e));this.ga=function(){return g(d.unwrap(e))};this.T=d.computed(function(){g();var c=d.unwrap(e);g(c);var b=this.g.J(),
c=this.ha.g.filter(c).J(),b=new a(c,[],b);this.g.clear();this.g.G(c);this.ia(b);b.I(this.F)}.bind(this));this.U=c.F.subscribe(function(c){var b;b=this.W;for(var g=this.g,f=d.unwrap(e),l=c.X.filter(f),k=[],h=c.ca.filter(f),p=0,q=c.da.length;p<q;p++){var r=c.da[p],u=g.ya(b(r));f(r)?u?k.push(r):l.push(r):u&&h.push(r)}b=new a(l,k,h);b.empty||(this.g.removeAll(b.ca),this.g.qa(b.da),this.g.G(b.X),this.ia(c),b.I(this.F))}.bind(this))}g.prototype=f.a.extend({},h.prototype,{dispose:function(){this.T.dispose();
this.U.dispose();this.wa()}});return k.rb=g})(r,p,z,q,u);(function(d,f,a,h){function k(g,c){a.call(this,g);this.g.G(g.g.J());var e=d.observable(d.unwrap(c));this.ga=function(){return e(d.unwrap(c))};this.T=d.computed(function(){e();var a=d.unwrap(c);e(a);this.g.jb(a)&&this.F.valueHasMutated()}.bind(this));this.U=g.F.subscribe(function(a){var c=this.g.mb(a.da);this.g.removeAll(a.ca.concat(c));this.g.Ya(a.X.concat(c));this.ia(a);this.F.valueHasMutated()}.bind(this))}k.prototype=f.a.extend({},a.prototype,
{O:function(){throw Error("Filtering a sorted view is not supported.");},R:function(){throw Error("Sorting a sorted view is not supported.");},dispose:function(){this.T.dispose();this.U.dispose();this.wa()}});return h.Ab=k})(r,p,q,u);(function(d,f,a,h){function k(g,c,e){function f(){return{offset:d.unwrap(c),f:d.unwrap(e)}}var k=g.r;this.va=g;this.c=d.observable(a.aa());this.n=null;var b=g.W,m=d.observable(f());this.ga=function(){var b=m(),a=f();b.offset===a.offset&&b.f===a.f||m(a)};this.T=d.computed(function(){g.F();
m();var a=f();m(a);var c=g.g,e=Math.min(c.length,a.offset),d=Math.min(c.length,e+a.f),a=this.c.peek(),c=c.slice(e,d);a:if(a.length!==c.length)e=!0;else{for(e=a.length-1;0<=e;--e)if(b(a.get(e))!==b(c.get(e))){e=!0;break a}e=!1}e&&(this.c(c),this.n&&(this.n(this.c.peek().map(k.s)),a.forEach(k.q)))}.bind(this))}k.prototype={get values(){return this.c},get P(){this.n||(this.n=d.observable(this.values().map(this.va.r.s)));return this.n},$:function(){this.va.$();this.ga()},O:function(){throw Error("Filtering a clipped view is not supported.");
},R:function(){throw Error("Sorting a clipped view is not supported.");},Sa:function(){throw Error("Clipping a clipped view is not supported.");},dispose:function(){this.T.dispose();this.n&&this.c().forEach(this.va.r.q)}};return h.nb=k})(r,p,v,u);G={yb:w};u=function(d){function f(a,d,g){this.h=a;this.b=g?function(a,e){var f=d(e);try{return a(f)}finally{g(f)}}:function(a,e){return a(d(e))}}f.prototype={forEach:function(a){this.h.forEach(this.b.bind(null,a))},map:function(a){return new f(this,a)},reduce:function(a,
d){return this.h.reduce(function(g,c){return a(g,this.b(function(a){return a},c))}.bind(this),d)}};var a=f.prototype;d.a.extend(a,{forEach:a.forEach,map:a.map,reduce:a.reduce});return f}(p);D=function(d,f,a){function h(){return 0}function k(){return!0}function g(b,a){this.e=b;this.b=a}function c(b){this.h=b;this.b=null}function e(b,a,c){this.e=b;this.Sb=a;this.Tb=c;this.Ua=!1;this.t=this.b=this.h=this.Aa=null}function l(b,a,c,e){this.i=b||k;this.j=a||h;this.offset=c||0;this.f=e||0===e?e:Number.POSITIVE_INFINITY;
this.D=Math.max(this.i===k?l.b:l.Ma,this.j===h?l.b:l.t,0===this.offset&&this.f===Number.POSITIVE_INFINITY?l.b:l.h)}function t(b,a,c){this.key=b;this.view=a;this.A=1;this.b=c}g.prototype={cb:function(b){return new c(this.Fa(b))},Fa:function(b){return new e(this.e,this.b,b)},kb:function(b){return this.S(b).then(function(b){return new a(b,this.e.s.bind(this.e),this.e.q.bind(this.e))}.bind(this))},Q:function(){throw Error("`"+this.constructor+"` does not implement `openView`.");},S:function(){throw Error("`"+
this.constructor+"` does not implement `streamValues`.");},dispose:function(){throw Error("`"+this.constructor+"` does not implement `dispose`.");}};g.prototype=f.a.extend({},{openEntryView:g.prototype.cb,openOptionalEntryView:g.prototype.Fa,streamObservables:g.prototype.kb},g.prototype);c.prototype={get value(){return this.h.value},get observable(){this.b||(this.b=this.h.w.subscribe(function(){throw Error("Illegal state: A non-optional view for this entry is still open.");}));return this.h.observable},
dispose:function(){this.b&&this.b.dispose();this.h.dispose()}};c.prototype=f.a.extend({},{get value(){return this.value},get observable(){return this.observable},dispose:c.prototype.dispose},c.prototype);e.prototype={N:function(){if(this.Ua)throw Error("Illegal state: Entry view was already disposed.");},get value(){this.N();return this.Aa=this.Sb(this.Tb)},get observable(){this.N();return(this.h||this.w)&&this.h},get w(){this.N();if(this.b)return this.b;var b=this.e.Jb(this.value);this.h=b();this.b=
d.observable({present:!0,observable:this.h});this.t=b.subscribe(function(b){this.b({present:!!b,observable:b})}.bind(this));return this.b},dispose:function(){this.N();this.Ua=!0;this.t&&(this.t.dispose(),this.e.q(this.Aa),this.Aa=this.h=this.b=this.t=null)}};e.prototype=f.a.extend({},{get value(){return this.value},get observable(){return this.observable},get optionalObservable(){return this.w},dispose:e.prototype.dispose},e.prototype);l.b=0;l.Ma=1;l.t=2;l.h=3;l.Va=function(b){return new l(b.i,b.j,
b.offset,b.f)};l.prototype={Z:function(b){return this.D===b.D&&this.i===b.i&&this.j===b.j&&this.offset===b.offset&&this.f===b.f},fb:function(){if(0>=this.D)throw Error("Unsupported operation.");var b=[null,this.i,this.j].slice(0,this.D);return new (l.bind.apply(l,b))},Ra:function(){return 0===this.D?[this]:this.fb().Ra().concat([this])},Mb:function(b){var a=[[this.i],[this.j],[this.offset,this.f]][this.D-1];return(0,[function(b){return b.O},function(b){return b.R},function(b){return b.Sa}][this.D-
1])(b).apply(b,a)}};t.prototype={s:function(){if(0>=this.A)throw Error("Assertion error: Reference count at `"+this.A+"`.");++this.A;return this},q:function(){0===--this.A&&this.b();return this}};g.ea=l;g.La=t;return g}(r,p,u);E=function(d,f){function a(a){this.V=a}a.prototype={forEach:function(a){this.V.forEach(a)},map:function(a){return new f(this,a)},reduce:function(a,g){return Promise.resolve(this.V.reduce(a,g))}};var h=a.prototype;d.a.extend(h,{forEach:h.forEach,map:h.map,reduce:h.reduce});return a}(p,
u);u=function(d){return function(){var f={};Array.prototype.slice.call(arguments).forEach(function(a){f[a]=!0});this.constructor=function(a){var h={};Object.keys(a).forEach(function(k){h[k]=f[k]?a[k]:d.observable(a[k])});return h};this.Ja=function(a,d){Object.keys(d).filter(function(a){return!f[a]}).forEach(function(f){return a[f](d[f])});return a}}}(r);x=function(d,f,a){function h(a){this.observable=a;this.w=d.observable(a);this.gb=1}return function(d,g){function c(b){if("string"!==typeof b)throw l(b);
if(f.a.v(t,b))return t[b];throw Error("No entry for id `"+b+"`.");}function e(b){var a=d(b);if("string"!==typeof a)throw l(a);Object.prototype.hasOwnProperty.call(t,a)?(a=t[a],++a.gb):(b=new h(g.constructor(b)),a=t[a]=b);return a}function l(b){throw Error("Illegal argument: Ids must be strings ('"+b+"' is of type '"+typeof b+"').");}g=g||new a;var t={};this.s=function(b){return e(b).observable};this.Jb=function(b){return e(b).w};this.q=function(b){b=d(b);0===--c(b).gb&&delete t[b]};this.Vb=function(b){return c(d(b)).observable};
this.eb=function(b){b.forEach(function(b){var a=d(b);f.a.v(t,a)&&(a=t[a],a.observable=g.constructor(b),a.w(a.observable))})};this.ra=function(b){b.forEach(function(b){var a=d(b);f.a.v(t,a)&&g.Ja(t[a].observable,b)})};this.Zb=function(b){f.a.Ca(t,function(a,c){var e=b(a);e?c.observable?g.Ja(c.observable,e):(c.observable=g.constructor(e),c.w(c.observable)):c.w(null)})};this.Ta=function(b){f.a.Ca(t,function(a,c){b(a)&&c.w(null)})};this.dispose=function(){this.Ta(function(){return!0})}.bind(this)}}(r,
p,u);q=function(d){var f,a,h;f=function(a){return function(d,c){return a.a.extend(d,{get stringifyable(){return c()}})}}(d);a=function(a,d){function c(){return 0}function e(b,a){return"string"===typeof b&&"string"===typeof a?b.localeCompare(a):b<=a?b<a?-1:0:1}function f(c,e){a.a.extend(c,{get onResultOf(){return this.ba},get reverse(){return this.reverse},get callable(){return this.Y}},{get ba(){return function(b){return h(b,c)}},get reverse(){return function(){return e||b(c)}},get Y(){return c}})}
function h(b,a){function c(e,d){return a(b(e),b(d))}f(c);d(c,function(){return{type:"by-function-comparator","function":b.stringifyable,comparator:a.stringifyable}});return c}function b(b){function a(c,e){return-b(c,e)}f(a,b);d(a,function(){return{type:"reversed-comparator",comparator:b.stringifyable}});return a}f(e);d(e,function(){return{type:"natural-comparator"}});f(c);d(c,function(){return{type:"indifferent-comparator"}});return{Ub:c,b:e}}(d,f);h=function(a,d){function c(c){a.a.extend(c,{get callable(){return this.Y}},
{get Y(){return c}})}return{Yb:function(a){function f(c){return c[a]}c(f);d(f,function(){return{type:"property-accessor",propertyName:a}});return f}}}(d,f);d=function(a,d){function c(){return!0}function e(){return!1}function f(c,e){a.a.extend(c,{get and(){return this.ja},get negate(){return this.ab},get onResultOf(){return this.ba},get or(){return this.ma},get callable(){return this.Y}},{get ja(){return function(b){return h([c,b])}},get ab(){return function(){return e||m(c)}},get ba(){return function(a){return b(a,
c)}},get ma(){return function(b){return H([c,b])}},get Y(){return c}})}function h(b){function a(c){for(var e=0,d=b.length;e<d;++e)if(!b[e](c))return!1;return!0}if(!b.length)return c;f(a);d(a,function(){return{type:"and-predicate",components:b.map(function(b){return b.stringifyable})}});return a}function b(b,a){function c(e){return a(b(e))}f(c);d(c,function(){return{type:"by-function-predicate","function":b.stringifyable,predicate:a.stringifyable}});return c}function m(b){function a(c){return!b(c)}
f(a,b);d(a,function(){return{type:"negated-predicate",predicate:b.stringifyable}});return a}function H(b){function a(c){for(var e=0,d=b.length;e<d;++e)if(b[e](c))return!0;return!1}if(!b.length)return e;f(a);d(a,function(){return{type:"or-predicate",components:b.map(function(b){return b.stringifyable})}});return a}f(e);d(e,function(){return{type:"always-false-predicate"}});f(c);d(c,function(){return{type:"always-true-predicate"}});return{b:e,Lb:c,ja:h,Da:function(b,a){function c(a){return b(a)}f(c);
d(c,a);return c},ma:H,$b:function(b){function a(c){return b.test(c)}f(a);d(a,function(){return{type:"regular-expression-predicate",regularExpression:b.source,caseSensitive:!b.ignoreCase,multiline:b.multiline}});return a}}}(d,f);return function(a){return a}({M:a,ka:h,H:d,Wb:f,cc:function(a,d){return"function"===typeof d||"object"===typeof d?d.stringifyable||d:d}})}(p);q=function(d,f,a){function h(a,d,c,e){this.Gb=a;this.u=d;this.Fb=c;this.Eb=e}h.prototype=f.a.extend({get predicate(){return this.i},
get comparator(){return this.j},get offset(){return this.offset},get limit(){return this.f}},{get i(){return this.Gb},get j(){return this.u},get offset(){return this.Fb},get f(){return this.Eb},normalize:function(){return new h(this.i||a.H.Lb,this.j||a.M.Ub,this.offset||0,this.f||0===this.f?this.f:Number.POSITIVE_INFINITY)},Ia:function(){return new h(d.unwrap(this.i),d.unwrap(this.j),d.unwrap(this.offset),d.unwrap(this.f))},Z:function(a){return this.i===a.i&&this.j===a.j&&this.offset===a.offset&&
this.f===a.f}});return h}(r,p,q);q=function(d,f){function a(a,d,c){f.call(this,a,d,c)}var h={Za:function(a){return new f(this.i,this.j,this.offset,a)}};a.prototype=d.a.extend({},f.prototype,h,{limitedTo:h.Za});return a}(p,q);q=function(d,f){function a(a,d){f.call(this,a,d)}var h={bb:function(a){return new f(this.i,this.j,a)}};a.prototype=d.a.extend({},f.prototype,h,{offsetBy:h.bb});return a}(p,q);q=function(d,f){function a(a){f.call(this,a)}var h={R:function(a){return new f(this.i,a)}};a.prototype=
d.a.extend({},f.prototype,h,{sortedBy:h.R});return a}(p,q);q=function(d,f){function a(){f.call(this)}var h={O:function(a){return new f(a)}};a.prototype=d.a.extend({},f.prototype,h,{filteredBy:h.O});return a}(p,q);A=function(d,f){function a(){f.call(this)}a.prototype=d.a.extend({},f.prototype);return a}(p,q);q=function(){function d(b,d){d=d||new l(b);var f=new e(b);g.call(this,d,function(a){return f.Wa(a)});this.fa=b;this.e=d;this.c=f;this.K=a.observable(new c);this.l=[];var h=new k.yb(this.fa,this.e,
this.c,this.K);this.Hb=this.Na(new g.ea,h);this.B=a.pureComputed(function(){return h.values().length})}function f(b,c){this.b=b;this.t=c;this.B=a.pureComputed(function(){return b.values().length});this.h=a.pureComputed(function(){return(h.o.na(c,function(a){return a.key.D===g.ea.Ma})||c[0]).view.values().length})}var a=r,h=p,k=G,g=D,c=z,e=y,l=x;d.prototype={get size(){return this.B},Na:function(a,c){var d=new g.La(a,c,function(){return this.l.splice(this.l.indexOf(d),1)}.bind(this));this.l.push(d);
return d},Db:function(a){var c=h.o.na(this.l,function(c){return a.Z(c.key)});if(c)return c.s();var d=a.fb(),c=h.o.ib(this.l,function(a){return d.Z(a.key)}).view,c=a.Mb(c);return this.Na(a,c)},Ib:function(a){this.c.G(a);(new c(a)).I(this.K);this.e.eb(a)},Kb:function(a){var d=[],e=[];a.forEach(function(a){return(this.c.contains(a)?e:d).push(a)}.bind(this));this.c.G(d);this.c.qa(e);(new c(d,e)).I(this.K);this.e.eb(d);this.e.ra(e)},Q:function(a){a=(a||function(a){return a})(new A);a=g.ea.Va(a).Ra().map(function(a){return this.Db(a)}.bind(this));
var c=a[a.length-1].view;c.$();return new f(c,a)},ac:function(a){this.c.removeAll(a);(new c([],[],a)).I(this.K);this.e.Ta(function(a){return!this.c.ya(a)}.bind(this))},bc:function(a){var d=this.c.J();this.c.clear();this.c.G(a);(new c(a,[],d)).I(this.K);this.e.Zb(function(a){return this.c.dc(a)}.bind(this))},S:function(a){a=this.Q(a);try{return Promise.resolve(new E(a.values.peek().slice()))}finally{a.dispose()}},ra:function(a){this.c.qa(a);(new c([],a)).I(this.K);this.e.ra(a)},dispose:function(){this.Hb.q();
this.e.dispose();if(this.l.length){var a=this.l.length,c=this.l.reduce(function(a,b){return a+b.A},0);window.console.warn("Some views were not or are not yet disposed ("+a+" views, "+c+" references).")}}};d.prototype=h.a.extend({},g.prototype,{get size(){return this.size},addEntries:d.prototype.Ib,dispose:d.prototype.dispose,addOrUpdateEntries:d.prototype.Kb,openView:d.prototype.Q,removeEntries:d.prototype.ac,replaceEntries:d.prototype.bc,streamValues:d.prototype.S,updateEntries:d.prototype.ra},d.prototype);
var t=a.pureComputed(function(){return!1});f.prototype={get za(){return t},get Ba(){return this.h},get Ea(){return a.pureComputed(function(){return{}})},get P(){return this.b.P},get size(){return this.B},get values(){return this.b.values},dispose:function(){this.t.forEach(function(a){a.q()})}};f.prototype=h.a.extend({get dirty(){return this.za},get filteredSize(){return this.Ba},get metadata(){return this.Ea},get observables(){return this.P},get size(){return this.size},get values(){return this.values},
dispose:f.prototype.dispose},f.prototype);return d}({});w=function(){function d(d,f,h){h=h||new g(d);var b={};k.call(this,h,function(a){if(!c(b,a))throw Error("No known entry with id `"+a+"`.");return b[a].value});this.fa=d;this.e=h;this.Pa=f;this.c=b;this.B=a.observable(0);this.Cb=a.pureComputed(function(){return this.B()}.bind(this));this.l=[]}function f(c,d,f){function b(a){if(a.i!==w||a.j!==x)return!1;for(var b=0,c=C.length;b<c;++b){var d=C[b];if(d.Da<=a.offset&&d.lb>=a.offset+a.f)return!0}return!1}
function g(a,b){if(a.i!==w||a.j===x){var c=a.i,d=a.j;v=[];C=[];z=0;w=c;x=d}else if(1024<z+b.length)for(d=C.shift(),c=d.Da,d=Math.max(v.length,d.lb);c<d;++c)delete v[c];c=a.offset;d=c+a.f;C.push({Da:c,lb:d>=q().filteredSize?Number.POSITIVE_INFINITY:d});for(var d=0,e=b.length;d<e;++d)v[c+d]=b[d]}var k=a.observable(!1),p=a.observable(!1),q=a.observable({unfilteredSize:c.size.peek(),filteredSize:0}),r=h.aa(),u=a.observable(),v=[],C=[],z=0,w=null,x=null,A=a.pureComputed(function(){if(k.peek())return k();
var a=d.Ia().normalize();if(b(a))return u(v.slice(a.offset,a.offset+a.f));p(!0);k(!0);window.setTimeout(function(){if(!a.Z(d.Ia().normalize()))return k(!1);c.Pa.issue(a).then(function(b){var d=[];b.values.reduce(function(a,b){return d.push(b)});u(d);delete b.values;c.B(b.unfilteredSize);q(b);g(a,d)}).then(function(){p(!1);k(!1)},function(){k(!1)})})}),y=a.pureComputed(function(){A();var a=u(),a=h.aa(a);B?(B=a.map(function(a){c.Oa(a);return c.e.s(a)}),r.forEach(function(a){c.Qa(a);c.e.q(a)})):(a.forEach(c.Oa.bind(c)),
r.forEach(c.Qa.bind(c)));return r=a});this.c=y;var B=null;this.n=a.pureComputed(function(){y();B||(B=r.map(c.e.s));return B});this.n.subscribe(function(){return B=null},null,"asleep");this.h=a.pureComputed(function(){return p()});this.N=a.pureComputed(function(){return q()});this.b=a.pureComputed(function(){return q().filteredSize});this.B=a.pureComputed(function(){return y().length});this.t=function(){A.dispose();f()}}var a=r,h=v,k=D,g=x,c=p.a.v;d.prototype={get size(){return this.Cb},Oa:function(a){var d=
this.fa(a);c(this.c,d)?(d=this.c[d],++d.A,d.value=a):this.c[d]={A:1,value:a}},Qa:function(a){a=this.fa(a);if(!c(this.c,a))throw Error("Assertion error: Value with id `"+a+"` was expected to be referenced.");0===--this.c[a].A&&delete this.c[a]},Q:function(a){a=(a||function(a){return a})(new A);var c=k.ea.Va(a),d=p.o.na(this.l,function(a){return c.Z(a.key)});if(d)return d.s().view;a=new f(this,a,function(){return b.q()});var b=new k.La(c,a,function(){return this.l.splice(this.l.indexOf(b),1)}.bind(this));
this.l.push(b);return a},S:function(a){a=(a||function(a){return a})(new A);return this.Pa.issue(a.Ia().normalize())},dispose:function(){this.e.dispose();if(this.l.length){var a=this.l.length,c=this.l.reduce(function(a,b){return a+b.A},0);window.console.warn("Some views were not or are not yet disposed ("+a+" views, "+c+" references).")}}};d.prototype=p.a.extend({},k.prototype,{get size(){return this.size},dispose:d.prototype.dispose,openView:d.prototype.Q,streamValues:d.prototype.S},d.prototype);
f.prototype={get za(){return this.h},get Ba(){return this.b},get Ea(){return this.N},get P(){return this.n},get size(){return this.B},get values(){return this.c},dispose:function(){this.t()}};f.prototype=p.a.extend({},{get dirty(){return this.za},get filteredSize(){return this.Ba},get metadata(){return this.Ea},get observables(){return this.P},get size(){return this.size},get values(){return this.values},dispose:f.prototype.dispose},f.prototype);return d}({});return function(d){return d}(function(d,
f,a,h,k){return{ClientSideDataSource:d,DefaultObservableStateTransitioner:f,ObservableEntries:a,ServerSideDataSource:h,streams:k}}(q,u,x,w,function(d,f){return{streamArray:function(a){return new f(d.aa(a))}}}(v,E)))}"function"===typeof define&&define.amd?define(["knockout"],F):window["ko-data-source"]=F(window.ko);